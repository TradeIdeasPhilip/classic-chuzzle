(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();var i={};Object.defineProperty(i,"__esModule",{value:!0});i.permutations=i.polarToRectangular=i.makeBoundedLinear=X=i.makeLinear=i.sum=i.countMap=N=i.initializedArray=i.count=i.zip=i.FIGURE_SPACE=i.NON_BREAKING_SPACE=i.dateIsValid=i.MIN_DATE=i.MAX_DATE=i.makePromise=i.filterMap=F=i.pick=i.pickAny=i.csvStringToArray=i.parseTimeT=i.parseIntX=i.parseFloatX=i.getAttribute=i.followPath=i.parseXml=i.testXml=_=i.sleep=U=i.assertClass=void 0;function oe(r,e,t="Assertion Failed."){const n=o=>{throw new Error(`${t}  Expected type:  ${e.name}.  Found type:  ${o}.`)};if(r===null)n("null");else if(typeof r!="object")n(typeof r);else if(!(r instanceof e))n(r.constructor.name);else return r;throw new Error("wtf")}var U=i.assertClass=oe;function se(r){return new Promise(e=>setTimeout(e,r))}var _=i.sleep=se;function Y(r){const t=new DOMParser().parseFromString(r,"application/xml");for(const n of Array.from(t.querySelectorAll("parsererror")))if(n instanceof HTMLElement)return{error:n};return{parsed:t}}i.testXml=Y;function ie(r){if(r!==void 0)return Y(r)?.parsed?.documentElement}i.parseXml=ie;function J(r,...e){for(const t of e){if(r===void 0)return;if(typeof t=="number")r=r.children[t];else{const n=r.getElementsByTagName(t);if(n.length!=1)return;r=n[0]}}return r}i.followPath=J;function ae(r,e,...t){if(e=J(e,...t),e!==void 0&&e.hasAttribute(r))return e.getAttribute(r)??void 0}i.getAttribute=ae;function Q(r){if(r==null)return;const e=parseFloat(r);if(isFinite(e))return e}i.parseFloatX=Q;function W(r){const e=Q(r);if(e!==void 0)return e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER||e!=Math.floor(e)?void 0:e}i.parseIntX=W;function le(r){if(typeof r=="string"&&(r=W(r)),r!=null&&!(r<=0))return new Date(r*1e3)}i.parseTimeT=le;const ce=r=>{const e=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,t=[[]];let n;for(;n=e.exec(r);)n[1].length&&n[1]!==","&&t.push([]),t[t.length-1].push(n[2]!==void 0?n[2].replace(/""/g,'"'):n[3]);return t};i.csvStringToArray=ce;function ue(r){const e=r.values().next();if(!e.done)return e.value}i.pickAny=ue;function fe(r){return r[Math.random()*r.length|0]}var F=i.pick=fe;function de(r,e){const t=[];return r.forEach((n,o)=>{const s=e(n,o);s!==void 0&&t.push(s)}),t}i.filterMap=de;function he(){let r,e;return{promise:new Promise((n,o)=>{r=n,e=o}),resolve:r,reject:e}}i.makePromise=he;i.MAX_DATE=new Date(864e13);i.MIN_DATE=new Date(-864e13);function pe(r){return isFinite(r.getTime())}i.dateIsValid=pe;i.NON_BREAKING_SPACE=" ";i.FIGURE_SPACE=" ";function*me(...r){const e=r.map(t=>t[Symbol.iterator]());for(;;){const t=e.map(n=>n.next());if(t.some(({done:n})=>n))break;yield t.map(({value:n})=>n)}}i.zip=me;function*we(r=0,e=1/0,t=1){for(let n=r;n<e;n+=t)yield n}i.count=we;function ee(r,e){const t=[];for(let n=0;n<r;n++)t.push(e(n));return t}var N=i.initializedArray=ee;i.countMap=ee;function ge(r){return r.reduce((e,t)=>e+t,0)}i.sum=ge;function Ee(r,e,t,n){const o=(n-e)/(t-r);return function(s){return(s-r)*o+e}}var X=i.makeLinear=Ee;function ve(r,e,t,n){t<r&&([r,e,t,n]=[t,n,r,e]);const o=(n-e)/(t-r);return function(s){return s<=r?e:s>=t?n:(s-r)*o+e}}i.makeBoundedLinear=ve;function Se(r,e){return{x:Math.sin(e)*r,y:Math.cos(e)*r}}i.polarToRectangular=Se;function*te(r,e=[]){if(r.length==0)yield e;else for(let t=0;t<r.length;t++){const n=r[t],o=[...e,n],s=[...r.slice(0,t),...r.slice(t+1)];yield*te(s,o)}}i.permutations=te;var E={};Object.defineProperty(E,"__esModule",{value:!0});E.download=E.createElementFromHTML=E.getHashInfo=E.getAudioBalanceControl=E.getBlobFromCanvas=E.loadDateTimeLocal=L=E.getById=void 0;const ne=i;function Me(r,e){const t=document.getElementById(r);if(!t)throw new Error("Could not find element with id "+r+".  Expected type:  "+e.name);if(t instanceof e)return t;throw new Error("Element with id "+r+" has type "+t.constructor.name+".  Expected type:  "+e.name)}var L=E.getById=Me;function ye(r,e,t="milliseconds"){let n;switch(t){case"minutes":{n=e.getSeconds()*1e3+e.getMilliseconds();break}case"seconds":{n=e.getMilliseconds();break}case"milliseconds":{n=0;break}default:throw new Error("wtf")}r.valueAsNumber=+e-e.getTimezoneOffset()*6e4-n}E.loadDateTimeLocal=ye;function Ie(r){const{reject:e,resolve:t,promise:n}=(0,ne.makePromise)();return r.toBlob(o=>{o?t(o):e(new Error("blob is null!"))}),n}E.getBlobFromCanvas=Ie;function be(r){const e=new AudioContext,t=e.createMediaElementSource(r),n=new StereoPannerNode(e,{pan:0});return t.connect(n).connect(e.destination),o=>{n.pan.value=o}}E.getAudioBalanceControl=be;function ke(){const r=new Map;return/^#?(.*)$/.exec(location.hash.replace("+","%20"))[1].split("&").forEach(n=>{const o=n.split("=",2);if(o.length==2){const s=decodeURIComponent(o[0]),a=decodeURIComponent(o[1]);r.set(s,a)}}),r}E.getHashInfo=ke;function Ae(r,e){var t=document.createElement("div");return t.innerHTML=r.trim(),(0,ne.assertClass)(t.firstChild,e,"createElementFromHTML:")}E.createElementFromHTML=Ae;function Ce(r,e){var t=document.createElement("a");if(t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),t.dispatchEvent(n)}else t.click()}E.download=Ce;class H{#e=new Set;get contents(){return this.#e}static#t=0;#n=H.#t++;debugInitialGroup;debugInfo(){return{row:this.debugInitialGroup.row,column:this.debugInitialGroup.column,contents:this.valid?this.#e.size:"invalid",id:this.#n}}color;constructor(e){this.color=e.color,this.debugInitialGroup=e,this.#e.add(e)}consume(e){const t=this.#e,n=e.#e;return n.forEach(o=>t.add(o)),e.#e=void 0,n}get valid(){return!!this.#e?.has(this.debugInitialGroup)}}class V{constructor(e,t,n){this.row=e,this.column=t,this.piece=n,this.#e=new H(this)}#e;get color(){return this.piece.color}static createAll(e){return e.allPieces.map((t,n)=>t.map((o,s)=>new V(n,s,o)))}tryCombine(e){if(this.#e!=e.#e&&this.color==e.color&&(this.#e.consume(e.#e).forEach(n=>n.#e=this.#e),!this.#e.valid))throw new Error("wtf")}static combineAll(e){e.forEach((t,n)=>{t.forEach((o,s)=>{if(n){const a=n-1,f=e[a][s];o.tryCombine(f)}if(s){const a=s-1,f=t[a];o.tryCombine(f)}})})}static findBigGroups(e){const t=new Map;e.forEach(o=>o.forEach(s=>{const a=s.#e,f=t.get(a)??0;t.set(a,f+1)}));const n=[];for(const[o,s]of t)s>=3&&n.push(o);return n}static findActionable(e){const t=this.createAll(e);return this.combineAll(t),this.findBigGroups(t)}}function $(r){return V.findActionable(r)}function x(r,e){const t=r%e;return t<0?t+Math.abs(e):t}function Pe(r,e){if((e|0)!=e)throw new Error(`invalid input: ${e}`);return e=x(e,r.length),e==0?r:[...r.slice(e),...r.slice(0,e)]}const K=["red","green","blue","yellow","orange","violet"];class l{constructor(e){this.allPieces=e}static SIZE=6;getColumn(e){return this.allPieces.map(t=>t[e])}static randomPiece(){return{weight:1,color:F(K)}}static createRandom(){const e=N(l.SIZE,()=>N(l.SIZE,this.randomPiece));return $(new l(e)).forEach(n=>{n.contents.forEach(({row:o,column:s})=>{const a=new Set;[[0,1],[0,-1],[1,0],[-1,0]].forEach(([f,d])=>{const u=e[o+f];if(u){const A=u[s+d];A&&a.add(A.color)}}),e[o][s]={color:F(K.filter(f=>!a.has(f))),weight:1}})}),new this(e)}rotateLeft(e,t){const n=this.allPieces[e],o=Pe(n,t);return n==o?this:new l(this.allPieces.map(s=>s==n?o:s))}rotateUp(e,t){const n=this.allPieces.length;return t=x(t,n),t==0?this:new l(this.allPieces.map((o,s)=>{const a=[...o];return a[e]=this.allPieces[(s+t)%n][e],a}))}compileAnimation(e){const t=N(l.SIZE,()=>new Set);e.forEach(s=>{s.contents.forEach(({row:a,column:f})=>{const d=t[f];if(d.has(a))throw new Error("wtf");d.add(a)})});const n=t.map(s=>({addFromBottom:[],addFromTop:[],indicesToRemove:s})),o=N(l.SIZE,()=>new Array(l.SIZE));return n.forEach((s,a)=>{const f=t[a],d=[];for(let u=0;u<l.SIZE;u++)f.has(u)||d.push(this.allPieces[u][a]);for(;d.length<l.SIZE;){const u=l.randomPiece();s.addFromTop.push(u),d.unshift(u)}d.forEach((u,A)=>o[A][a]=u)}),{columns:n,final:new l(o)}}}{let r="☆";setInterval(()=>{document.title=`${r} Classic Chuzzle`,r=r=="☆"?"★":"☆"},1e3)}class g{constructor(e){this.piece=e,e[g.#i]=this;const t=U(g.#t.cloneNode(!0),SVGGElement);this.element=t,this.decorationElement=t.querySelector("text"),t.setAttribute("fill",e.color),g.#e.appendChild(t)}static flashGroupDecorations(e){e.forEach(t=>{const n=[...t.contents].map(d=>g.for(d.piece)),o=1,a=[{opacity:Math.random()*.2+.05},{opacity:o}],f={direction:F(["alternate","alternate-reverse","normal","reverse"]),duration:550+Math.random()*150,easing:F(["linear","ease-in","ease-out","ease-in-out"]),iterationStart:Math.random(),iterations:1/0};n.forEach(d=>{d.decorationElement.animate(a,f)})})}static removeAll(){this.#e.innerHTML=""}static#e=L("board",SVGElement);static#t=L("piece",HTMLTemplateElement).content.querySelector("g");element;decorationElement;static#n=CSS.px(Math.E);static#r=CSS.px(Math.PI);static#a=new CSSTransformValue([new CSSTranslate(this.#n,this.#r)]);#o=0;get row(){return this.#o}#s=0;get column(){return this.#s}setPosition(e,t){g.#n.value=this.#s=t,g.#r.value=this.#o=e,this.element.attributeStyleMap.set("transform",g.#a)}animateMove(e,t,n){const o=this.#s,s=this.#o;this.setPosition(e,t);const a=this.element;return a.parentElement?.appendChild(a),a.animate([{transform:`translate(${o}px, ${s}px)`},{transform:`translate(${t}px, ${e}px)`}],n).finished}static#i=Symbol("GuiPiece");static for(e){const t=e[this.#i];if(!(t instanceof g))throw console.error(t),new Error("wtf");return t}}class z{#e=[];#t=l.createRandom();get currentBoard(){return this.#t}set currentBoard(e){this.#t=e,this.draw()}static#n=new Map([["orange",["cyan","brown","white","darkviolet","lightyellow","darkgreen","darkolivegreen","darkred"]],["yellow",["brown","darkviolet","lightcoral","lightsalmon","lightseagreen","darkblue","darkcyan","darkgoldenrod","darkgreen","darkkhaki","darkolivegreen","darkorange","darkred","darksalmon","darkseagreen"]],["violet",["cyan","brown","white","darkviolet","lightgreen","darkblue"]],["blue",["cyan","white","lightcoral","lightgreen","lightgray","lightsalmon","lightseagreen","lightseagreen","lightskyblue","lightslategray","darkorange","darkseagreen","darkturquoise"]],["red",["cyan","white","lightcoral","lightgreen","lightsalmon","darkkhaki","darkseagreen","chartreuse"]],["green",["cyan","white","lightcoral","lightcyan","lightgreen","lightyellow","darkred","darkseagreen","chartreuse"]]]);static#r=["ʻ","☆","𝛿","∞","•","⭑","†","‡","؟","*","◦","§","_","ɝ","Ԕ","⟳","⚐","🜚","愛","❝","ℵ","を","ᇸ","ڰ","ॾ","ৼ","ན","ᛧ","ß","⧕","↯","➷","⅋","☙","„","⌥","⧷","⁎","╕","₰","…","⑈","۽","ₜ","ಠ","෴","ጃ","ᔱ","ᔰ","Ѧ","ᑥ","𝄢"];showGroupsDeferred(e){if(e.length==0)return()=>{};{const t=[],n=[...z.#r];return e.forEach(o=>{const s=F(z.#n.get(o.color)),a=Math.floor(Math.random()*n.length),f=n[a];n.splice(a,1),t.push(()=>{o.contents.forEach(d=>{const u=g.for(d.piece).decorationElement;u.textContent=f,u.style.fill=s})})}),()=>t.forEach(o=>o())}}removeGroups(){this.#e.forEach(e=>e.forEach(t=>t.element.querySelector("text").textContent=""))}draw(){this.resetAll(),this.#e=this.#t.allPieces.map((e,t)=>e.map((n,o)=>{const s=new g(n);return s.setPosition(t,o),s}))}resetAll(){g.removeAll(),this.#e=[]}static animationOptions(e){return{duration:Math.abs(e)*2e3/l.SIZE}}constructor(){this.draw();const e=L("board",SVGElement);function t(h){const c=e.getBoundingClientRect(),Z=X(c.top,0,c.bottom,l.SIZE),p=X(c.left,0,c.right,l.SIZE);return{row:Z(h.clientY),column:p(h.clientX)}}let n="none",o=-1,s=-1,a=-1;e.addEventListener("pointerdown",h=>{if(n=="none"){h.stopPropagation(),n="started",e.setPointerCapture(h.pointerId);const c=t(h);o=c.row,s=c.column,e.style.cursor="move"}});const f=h=>{switch(n){case"none":case"started":case"animation":return;case"horizontal":{const{column:c}=t(h);return s-c}case"vertical":{const{row:c}=t(h);return o-c}}throw new Error("wtf")},d=h=>{if(n=="none")return 0;{const c=t(h);if(n=="horizontal")return x(Math.round(s-c.column),l.SIZE);if(n=="vertical")return x(Math.round(o-c.row),l.SIZE);if(n=="started")return 0}throw new Error("wtf")};let u,A=0;e.addEventListener("pointermove",h=>{if(n=="none"||n=="animation")return;h.stopPropagation();const c=t(h);if(n=="started"){const p=Math.abs(c.row-o),C=Math.abs(c.column-s);if(Math.max(p,C)<.05)return;if(p>C)n="vertical",e.style.cursor="ns-resize",a=Math.floor(s);else if(C>p)n="horizontal",e.style.cursor="ew-resize",a=Math.floor(o);else return;if(a=Math.max(0,Math.min(l.SIZE,a)),u)throw new Error("wtf");const O=n=="vertical"?"rotateUp":"rotateLeft";u=N(l.SIZE,P=>{const G=this.#t[O](a,P),D=$(G),T=this.showGroupsDeferred(D);return{board:G,groups:D,showGroups:T}}),A=0}const Z=p=>x(p+.5,l.SIZE)-.5;if(n=="horizontal"){const p=s-c.column;this.#e[a].forEach((O,P)=>{O.setPosition(a,Z(P-p))})}else if(n=="vertical"){const p=o-c.row;this.#e.forEach((C,O)=>{C[a].setPosition(Z(O-p),a)})}if(u){const p=d(h);p!=A&&(A=p,this.removeGroups(),u[A].showGroups())}}),e.addEventListener("lostpointercapture",async h=>{if(n=="none"||n=="started"){if(n="none",e.style.cursor="",u)throw new Error("wtf");return}e.style.cursor="none";const c=[];if(!u)throw new Error("wtf");const Z=d(h),p=u[Z],{newBoard:C,newOffset:O}=p.groups.length==0?{newBoard:this.currentBoard,newOffset:0}:{newBoard:p.board,newOffset:Z},P=x(f(h)-O+l.SIZE/2,l.SIZE)-l.SIZE/2,G=z.animationOptions(P),D=I=>{const v=[I],S=[0],w=x(Math.round(I+P),l.SIZE);if(w>5.1)throw new Error("wtf");const y=(M,m)=>{v.push(M,m);const b=Math.abs(I-M),k=Math.abs(m-w),R=b+k,B=b/R;S.push(B,B)};return Math.sign(P)==-1?w>I&&y(-.5,l.SIZE-.5):w<I&&y(l.SIZE-.5,-.5),v.push(w),S.push(1),{position:v,offset:S,finalPosition:w}};n=="horizontal"?this.#e[a].forEach(v=>{const{position:S,offset:w,finalPosition:y}=D(v.column),M=S.map(m=>`translate(${m}px, ${a}px)`);c.push(v.element.animate({transform:M,offset:w},G).finished),v.setPosition(a,y)}):n=="vertical"&&this.#e.forEach(I=>{const v=I[a],{position:S,offset:w,finalPosition:y}=D(v.row),M=S.map(m=>`translate(${a}px, ${m}px)`);c.push(v.element.animate({transform:M,offset:w},G).finished),v.setPosition(y,a)}),n="animation",c.length>0&&(await Promise.all(c),c.length=0,this.currentBoard=C),u=void 0;let{groups:T,showGroups:j}=p;for(;T.length>0&&T.length!=0;){j(),g.flashGroupDecorations(T),await _(2e3);const{columns:I,final:v}=this.currentBoard.compileAnimation(T);I.forEach((S,w)=>{for(const y of S.indicesToRemove){const M=this.#e[y][w];let m,b;m=Math.random()*(l.SIZE/2-1),b=Math.random()*(l.SIZE/2-1);{const k=Math.random()*3;k>1&&(m-=l.SIZE/2),k<2&&(b-=l.SIZE/2)}{const k=R=>Math.random()>(R+1)/(l.SIZE+1);k(y)&&(m=l.SIZE-m-1),k(w)&&(b=l.SIZE-b-1)}c.push(M.animateMove(m,b,{duration:1e3,easing:"ease-in"}))}}),await Promise.all(c),c.length=0,I.forEach(({addFromTop:S,addFromBottom:w,indicesToRemove:y},M)=>{if(w.length>0)throw new Error("Not implemented yet.");if(w.length+S.length!=y.size)throw new Error("wtf");let m=S.length;const b=z.animationOptions(m);S.forEach((k,R)=>{const B=new g(k),q=-(R+1),re=q+m;B.setPosition(q,M),c.push(B.animateMove(re,M,b))}),this.currentBoard.getColumn(M).forEach((k,R)=>{y.has(R)?m--:m&&g.for(k).animateMove(R+m,M,b)})}),await Promise.all(c),c.length=0,this.currentBoard=v,T=$(v),j=this.showGroupsDeferred(T)}e.style.cursor="",n="none"})}}new z;
