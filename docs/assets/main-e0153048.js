(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var f={},a={};Object.defineProperty(a,"__esModule",{value:!0});a.permutations=a.polarToRectangular=a.makeBoundedLinear=A=a.makeLinear=a.sum=a.countMap=p=a.initializedArray=a.count=a.zip=a.FIGURE_SPACE=a.NON_BREAKING_SPACE=a.dateIsValid=a.MIN_DATE=a.MAX_DATE=a.makePromise=a.filterMap=v=a.pick=a.pickAny=a.csvStringToArray=a.parseTimeT=a.parseIntX=a.parseFloatX=a.getAttribute=a.followPath=a.parseXml=a.testXml=Z=a.sleep=a.assertClass=void 0;function V(o,e,n="Assertion Failed."){const t=r=>{throw new Error(`${n}  Expected type:  ${e.name}.  Found type:  ${r}.`)};if(o===null)t("null");else if(typeof o!="object")t(typeof o);else if(!(o instanceof e))t(o.constructor.name);else return o;throw new Error("wtf")}a.assertClass=V;function _(o){return new Promise(e=>setTimeout(e,o))}var Z=a.sleep=_;function L(o){const n=new DOMParser().parseFromString(o,"application/xml");for(const t of Array.from(n.querySelectorAll("parsererror")))if(t instanceof HTMLElement)return{error:t};return{parsed:n}}a.testXml=L;function j(o){if(o!==void 0)return L(o)?.parsed?.documentElement}a.parseXml=j;function D(o,...e){for(const n of e){if(o===void 0)return;if(typeof n=="number")o=o.children[n];else{const t=o.getElementsByTagName(n);if(t.length!=1)return;o=t[0]}}return o}a.followPath=D;function U(o,e,...n){if(e=D(e,...n),e!==void 0&&e.hasAttribute(o))return e.getAttribute(o)??void 0}a.getAttribute=U;function N(o){if(o==null)return;const e=parseFloat(o);if(isFinite(e))return e}a.parseFloatX=N;function O(o){const e=N(o);if(e!==void 0)return e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER||e!=Math.floor(e)?void 0:e}a.parseIntX=O;function q(o){if(typeof o=="string"&&(o=O(o)),o!=null&&!(o<=0))return new Date(o*1e3)}a.parseTimeT=q;const K=o=>{const e=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,n=[[]];let t;for(;t=e.exec(o);)t[1].length&&t[1]!==","&&n.push([]),n[n.length-1].push(t[2]!==void 0?t[2].replace(/""/g,'"'):t[3]);return n};a.csvStringToArray=K;function Y(o){const e=o.values().next();if(!e.done)return e.value}a.pickAny=Y;function J(o){return o[Math.random()*o.length|0]}var v=a.pick=J;function Q(o,e){const n=[];return o.forEach((t,r)=>{const s=e(t,r);s!==void 0&&n.push(s)}),n}a.filterMap=Q;function W(){let o,e;return{promise:new Promise((t,r)=>{o=t,e=r}),resolve:o,reject:e}}a.makePromise=W;a.MAX_DATE=new Date(864e13);a.MIN_DATE=new Date(-864e13);function ee(o){return isFinite(o.getTime())}a.dateIsValid=ee;a.NON_BREAKING_SPACE=" ";a.FIGURE_SPACE=" ";function*te(...o){const e=o.map(n=>n[Symbol.iterator]());for(;;){const n=e.map(t=>t.next());if(n.some(({done:t})=>t))break;yield n.map(({value:t})=>t)}}a.zip=te;function*ne(o=0,e=1/0,n=1){for(let t=o;t<e;t+=n)yield t}a.count=ne;function $(o,e){const n=[];for(let t=0;t<o;t++)n.push(e(t));return n}var p=a.initializedArray=$;a.countMap=$;function oe(o){return o.reduce((e,n)=>e+n,0)}a.sum=oe;function re(o,e,n,t){const r=(t-e)/(n-o);return function(s){return(s-o)*r+e}}var A=a.makeLinear=re;function se(o,e,n,t){n<o&&([o,e,n,t]=[n,t,o,e]);const r=(t-e)/(n-o);return function(s){return s<=o?e:s>=n?t:(s-o)*r+e}}a.makeBoundedLinear=se;function ie(o,e){return{x:Math.sin(e)*o,y:Math.cos(e)*o}}a.polarToRectangular=ie;function*B(o,e=[]){if(o.length==0)yield e;else for(let n=0;n<o.length;n++){const t=o[n],r=[...e,t],s=[...o.slice(0,n),...o.slice(n+1)];yield*B(s,r)}}a.permutations=B;Object.defineProperty(f,"__esModule",{value:!0});f.download=f.createElementFromHTML=f.getHashInfo=f.getAudioBalanceControl=f.getBlobFromCanvas=f.loadDateTimeLocal=g=f.getById=void 0;const H=a;function ae(o,e){const n=document.getElementById(o);if(!n)throw new Error("Could not find element with id "+o+".  Expected type:  "+e.name);if(n instanceof e)return n;throw new Error("Element with id "+o+" has type "+n.constructor.name+".  Expected type:  "+e.name)}var g=f.getById=ae;function le(o,e,n="milliseconds"){let t;switch(n){case"minutes":{t=e.getSeconds()*1e3+e.getMilliseconds();break}case"seconds":{t=e.getMilliseconds();break}case"milliseconds":{t=0;break}default:throw new Error("wtf")}o.valueAsNumber=+e-e.getTimezoneOffset()*6e4-t}f.loadDateTimeLocal=le;function ce(o){const{reject:e,resolve:n,promise:t}=(0,H.makePromise)();return o.toBlob(r=>{r?n(r):e(new Error("blob is null!"))}),t}f.getBlobFromCanvas=ce;function ue(o){const e=new AudioContext,n=e.createMediaElementSource(o),t=new StereoPannerNode(e,{pan:0});return n.connect(t).connect(e.destination),r=>{t.pan.value=r}}f.getAudioBalanceControl=ue;function de(){const o=new Map;return/^#?(.*)$/.exec(location.hash.replace("+","%20"))[1].split("&").forEach(t=>{const r=t.split("=",2);if(r.length==2){const s=decodeURIComponent(r[0]),i=decodeURIComponent(r[1]);o.set(s,i)}}),o}f.getHashInfo=de;function he(o,e){var n=document.createElement("div");return n.innerHTML=o.trim(),(0,H.assertClass)(n.firstChild,e,"createElementFromHTML:")}f.createElementFromHTML=he;function fe(o,e){var n=document.createElement("a");if(n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",o),document.createEvent){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),n.dispatchEvent(t)}else n.click()}f.download=fe;class me{#e=new Set;get contents(){return[...this.#e].map(e=>e.piece)}get size(){return this.#e.size}debugInitialCell;color;constructor(e){this.color=e.color,this.debugInitialCell=e,this.#e.add(e)}consume(e){const n=this.#e,t=e.#e;return t.forEach(r=>n.add(r)),e.#e=void 0,t}get valid(){return!!this.#e?.has(this.debugInitialCell)}}class P{constructor(e){this.piece=e,this.#e=new me(this)}#e;get color(){return this.piece.color}static createAll(e){return e.map(n=>n.map(t=>new P(t)))}tryCombine(e){if(this.#e!=e.#e&&this.color==e.color&&(this.#e.consume(e.#e).forEach(t=>t.#e=this.#e),!this.#e.valid))throw new Error("wtf")}static combineAll(e){e.forEach((n,t)=>{n.forEach((r,s)=>{if(t){const i=t-1,l=e[i][s];r.tryCombine(l)}if(s){const i=s-1,l=n[i];r.tryCombine(l)}})})}static findBigGroups(e){const n=new Map;e.forEach(r=>r.forEach(s=>{const i=s.#e,l=n.get(i)??0;n.set(i,l+1)}));const t=[];for(const[r,s]of n)s>=3&&t.push(r);return t}static findActionable(e){const n=this.createAll(e);return this.combineAll(n),this.findBigGroups(n)}}function M(o){return P.findActionable(o).map(e=>e.contents)}function I(o,e){const n=o%e;return n<0?n+Math.abs(e):n}function pe(o,e){if((e|0)!=e)throw new Error(`invalid input: ${e}`);return e=I(e,o.length),e==0?o:[...o.slice(e),...o.slice(0,e)]}function ge(o,e,n="Assertion Failed."){const t=r=>{throw new Error(`${n}  Expected type:  ${e.name}.  Found type:  ${r}.`)};if(o===null)t("null");else if(typeof o!="object")t(typeof o);else if(!(o instanceof e))t(o.constructor.name);else return o;throw new Error("wtf")}const S=o=>I(Math.round(o),h.SIZE);function we(o,e,n){const t=o[e],r=pe(t,n);return t==r?o:o.map(s=>s==t?r:s)}function Ee(o,e,n){const t=o.length;return n=I(n,t),n==0?o:o.map((r,s)=>{const i=[...r];return i[e]=o[(s+n)%t][e],i})}const m=["red","green","blue","yellow","orange","violet"];class y{constructor(e,n,t=y.randomColor()){this.rowIndex=e,this.columnIndex=n,this.color=t}weight=1;#e=!1;get bomb(){return this.#e}set bomb(e){this.#e=e}static randomColor(){return v(m)}}class h{constructor(e){this.animator=e,this.#e=this.createRandom(),this.#e.forEach(n=>n.forEach(t=>this.animator.initializePiece(t)))}static SIZE=6;#e;getColumn(e){return this.#e.map(n=>n[e])}createRandom(){const e=p(h.SIZE,t=>p(h.SIZE,r=>new y(t,r)));return M(e).forEach(t=>{t.forEach(({rowIndex:r,columnIndex:s})=>{const i=new Set;[[0,1],[0,-1],[1,0],[-1,0]].forEach(([l,c])=>{const u=e[r+l];if(u){const d=u[s+c];d&&i.add(d.color)}}),e[r][s]=new y(r,s,v(m.filter(l=>!i.has(l))))})}),e}async updateLoop(e,n){for(let t=1;e.length>0;t++)await n.addToScore(t),await this.removeGroups(e),e=M(this.#e),n=this.animator.assignGroupDecorations(e),n.highlightGroups()}setAllPieces(e){this.#e=e,e.forEach((n,t)=>{n.forEach((r,s)=>{r.columnIndex=s,r.rowIndex=t})})}startHorizontalMove(e){const n=p(h.SIZE,s=>{const i=we(this.#e,e,-s),l=M(i);return{actions:this.animator.assignGroupDecorations(l),groups:l,pieces:i}}),t=s=>{const i=this.#e[e];this.animator.drawPreview("horizontal",i,s),n[S(s)].actions.highlightGroups()};return{preview:t,release:async s=>{t(s);const i=S(s),c=n[i].groups.length==0?0:i,u=n[c];this.setAllPieces(u.pieces);const d=this.#e[e];await this.animator.rotateTo("horizontal",d),await this.updateLoop(u.groups,u.actions)}}}startVerticalMove(e){const n=p(h.SIZE,s=>{const i=Ee(this.#e,e,-s),l=M(i);return{actions:this.animator.assignGroupDecorations(l),groups:l,pieces:i}}),t=s=>{const i=this.getColumn(e);this.animator.drawPreview("vertical",i,s),n[S(s)].actions.highlightGroups()};return{preview:t,release:async s=>{t(s);const i=S(s),c=n[i].groups.length==0?0:i,u=n[c];this.setAllPieces(u.pieces);const d=this.getColumn(e);await this.animator.rotateTo("vertical",d),await this.updateLoop(u.groups,u.actions)}}}async removeGroups(e){const n=p(h.SIZE,()=>new Set);{const s=[];e.forEach(i=>{i.forEach(({rowIndex:l,columnIndex:c})=>{const u=n[c];if(u.has(l))throw new Error("wtf");u.add(l),s.push(this.animator.destroyPiece(this.#e[l][c]))})}),await Promise.all(s)}const t=p(h.SIZE,()=>new Array(h.SIZE)),r=[];n.forEach((s,i)=>{const l=[];for(let c=0;c<h.SIZE;c++)s.has(c)||l.push(this.#e[c][i]);for(let c=0;l.length<h.SIZE;c++){const u=-1-c,d=new y(u,i);this.animator.initializePiece(d),l.unshift(d)}l.forEach((c,u)=>{t[u][i]=c,c.columnIndex=i,c.rowIndex=u,r.push(c)})}),await Promise.all(r.map(s=>this.animator.slideTo(s))),this.setAllPieces(t)}}const k=g("newScore",HTMLDivElement),x=g("chainBonus",HTMLDivElement),ve=new Map([["orange",["cyan","brown","white","darkviolet","lightyellow","darkgreen","darkolivegreen","darkred"]],["yellow",["brown","darkviolet","lightcoral","lightsalmon","lightseagreen","darkblue","darkcyan","darkgoldenrod","darkgreen","darkkhaki","darkolivegreen","darkorange","darkred","darksalmon","darkseagreen"]],["violet",["cyan","brown","white","darkviolet","lightgreen","darkblue"]],["blue",["cyan","white","lightcoral","lightgreen","lightgray","lightsalmon","lightseagreen","lightseagreen","lightskyblue","lightslategray","darkorange","darkseagreen","darkturquoise"]],["red",["cyan","white","lightcoral","lightgreen","lightsalmon","darkkhaki","darkseagreen","chartreuse"]],["green",["cyan","white","lightcoral","lightcyan","lightgreen","lightyellow","darkred","darkseagreen","chartreuse"]]]),ye=["ʻ","☆","𝛿","∞","•","⭑","†","‡","؟","༗","ၯ","◦","§","_","ɝ","Ԕ","⟳","⚐","🜚","愛","❝","ℵ","を","ᇸ","ڰ","ॾ","ৼ","ན","ᛧ","ß","⧕","↯","➷","⅋","☙","„","⌥","⧷","⁎","╕","₰","…","⑈","۽","ₜ","ಠ","෴","ጃ","ᔱ","ᔰ","Ѧ","ᑥ","𝄢","ƈ","Ɣ","ƕ","Ɋ","ɕ","ɮ","ʆ","Ξ","Ж","Ѭ","Զ","ঔ","ਐ","ઝ","ଈ","ஜ","ధ","ൠ","ඊ","ጯ","ᡀ","‰","₻","↉","↜","↸","⋨","⌤","⎌","⍾","☏","✗","➘","〷","ご","ᇌ","㊤","﹆","🜇","🝤"];function R(o){return{duration:Math.abs(o)*2e3/h.SIZE}}const X=g("board",SVGElement);function z(){X.querySelectorAll("text.crystal-decoration").forEach(o=>o.textContent="")}class E{static#e=g("piece",HTMLTemplateElement).content.querySelector("g");element;decorationElement;static#o=CSS.px(Math.E);static#r=CSS.px(Math.PI);static#s=new CSSTransformValue([new CSSTranslate(this.#o,this.#r)]);updateFinalPosition(e){this.#n=e.columnIndex,this.#t=e.rowIndex,E.#o.value=e.columnIndex,E.#r.value=e.rowIndex,this.element.attributeStyleMap.set("transform",E.#s)}async slideDirectlyTo(e,n){const t=this.#n,r=this.#t;this.updateFinalPosition(e);const s=this.#n,i=this.#t;if(!n){const u=Math.hypot(i-r,s-t);n=R(u)}const l=this.element;l.parentElement?.appendChild(l),await l.animate([{transform:`translate(${t}px, ${r}px)`},{transform:`translate(${e.columnIndex}px, ${e.rowIndex}px)`}],n).finished}async rotateTo(e,n){const t=n=="horizontal",r=(()=>{const c=t?e.columnIndex-this.#n:e.rowIndex-this.#t,u=I(c+h.SIZE/2,h.SIZE)-h.SIZE/2;return R(Math.abs(u))})(),{position:s,offset:i}=t?G(this.#n,e.columnIndex):G(this.#t,e.rowIndex),l=s.map(c=>t?`translate(${c}px, ${e.rowIndex}px)`:`translate(${e.columnIndex}px, ${c}px)`);this.updateFinalPosition(e),await this.element.animate({transform:l,offset:i},r).finished}#t=NaN;#n=NaN;constructor(e){const n=ge(E.#e.cloneNode(!0),SVGGElement);this.element=n,this.decorationElement=n.querySelector("text.crystal-decoration"),n.setAttribute("fill",e.color),this.updateFinalPosition(e),X.appendChild(n)}async remove(){let e,n;e=Math.random()*(h.SIZE/2-1),n=Math.random()*(h.SIZE/2-1);{const t=Math.random()*3;t>1&&(e-=h.SIZE/2),t<2&&(n-=h.SIZE/2)}{const t=r=>Math.random()>(r+1)/(h.SIZE+1);t(this.#t)&&(e=h.SIZE-e-1),t(this.#n)&&(n=h.SIZE-n-1)}await this.slideDirectlyTo({rowIndex:e,columnIndex:n},{duration:1e3,easing:"ease-in"}),this.element.remove(),this.element="💀"}}const F=o=>I(o+.5,h.SIZE)-.5,G=(o,e)=>{const n=[o],t=[0];if(Math.abs(o-e)>h.SIZE/2){const r=(s,i)=>{n.push(s,i);const l=Math.abs(o-s),c=Math.abs(i-e),u=l+c,d=l/u;t.push(d,d)};e>o?r(-.5,h.SIZE-.5):r(h.SIZE-.5,-.5)}return n.push(e),t.push(1),{position:n,offset:t}};class Ie{#e=new Map;initializePiece(e){this.#e.set(e,new E(e))}destroyPiece(e){const n=this.#e.get(e);return this.#e.delete(e),n.remove()}jumpTo(e){this.#e.get(e).updateFinalPosition(e)}slideTo(e){return this.#e.get(e).slideDirectlyTo(e)}drawPreview(e,n,t){n.forEach(r=>{const s=this.#e.get(r);let{rowIndex:i,columnIndex:l}=r;e=="vertical"?i=F(i+t):l=F(l+t),s.updateFinalPosition({rowIndex:i,columnIndex:l})})}async rotateTo(e,n){const t=n.map(r=>this.#e.get(r).rotateTo(r,e));await Promise.all(t)}updateBomb(e){throw new Error("Method not implemented.")}assignGroupDecorations(e){if(e.length==0)return{addToScore(){return Promise.resolve()},highlightGroups(){z()}};{const n=[...ye],t=e.map(r=>{const s=r[0].color,i=v(ve.get(s)),l=Math.floor(Math.random()*n.length),c=n[l];return n.splice(l,1),{guiPieces:r.map(d=>{const w=this.#e.get(d);if(w==null)throw new Error("wtf");return w}),decorationColor:i,decorationText:c,backgroundColor:s}});return{async addToScore(r){t.forEach(({guiPieces:s})=>{const c=[{opacity:Math.random()*.2+.05},{opacity:1}],u={direction:v(["alternate","alternate-reverse","normal","reverse"]),duration:550+Math.random()*150,easing:v(["linear","ease-in","ease-out","ease-in-out"]),iterationStart:Math.random(),iterations:1/0};s.forEach(d=>{d.decorationElement.animate(c,u)})}),r<2?x.innerHTML="":x.innerText=`Chain Bonus: ⨉ ${r}`,k.innerHTML="",t.forEach(({guiPieces:s,decorationColor:i,decorationText:l,backgroundColor:c},u)=>{u>0&&k.append(" + ");const d=document.createElement("span");d.innerText=`${l} ${s.length}`,d.style.color=i,d.style.borderColor=d.style.backgroundColor=c,d.classList.add("individualScore"),k.appendChild(d)}),await Z(2e3)},highlightGroups(){z(),t.forEach(({guiPieces:r,decorationColor:s,decorationText:i})=>{r.forEach(l=>{const c=l.decorationElement;c.textContent=i,c.style.fill=s})})}}}}}const Me=new Ie,Se=""+new URL("cursor-2110db60.svg",import.meta.url).href;function be(o){const e=g("main",SVGSVGElement);function n(r){const s=e.getBoundingClientRect(),i=A(s.top,0,s.bottom,h.SIZE),l=A(s.left,0,s.right,h.SIZE);return{row:i(r.clientY),column:l(r.clientX)}}let t={state:"none"};e.addEventListener("pointerdown",r=>{if(t.state=="none"){r.stopPropagation(),e.setPointerCapture(r.pointerId);const s=n(r);e.style.cursor="move",t={state:"started",startRow:s.row,startColumn:s.column}}}),e.addEventListener("pointermove",r=>{if(t.state=="none"||t.state=="animation")return;r.stopPropagation();const s=n(r);if(t.state=="started"){const i=Math.abs(s.row-t.startRow),l=Math.abs(s.column-t.startColumn);if(Math.max(i,l)<.05)return;if(i>l){const c="vertical",u=Math.floor(t.startColumn),d=t.startRow,w=C=>{const{row:T}=n(C);return T-d},b=o.startVerticalMove(u);t={state:c,fixedIndex:u,startIndex:d,relevantMouseMove:w,actions:b},e.style.cursor="ns-resize"}else if(l>i){const c="horizontal",u=Math.floor(t.startRow),d=t.startColumn,w=C=>{const{column:T}=n(C);return T-d},b=o.startHorizontalMove(u);t={state:c,fixedIndex:u,startIndex:d,relevantMouseMove:w,actions:b},e.style.cursor="ew-resize"}else return}t.actions.preview(t.relevantMouseMove(r))}),e.addEventListener("lostpointercapture",async r=>{switch(t.state){case"started":break;case"horizontal":case"vertical":{e.style.cursor=`url("${Se}"),none`;const s=t;t={state:"animation"},await s.actions.release(s.relevantMouseMove(r));break}default:throw new Error("wtf")}t={state:"none"},e.style.cursor="grab"})}{let o="☆";setInterval(()=>{document.title=`${o} Classic Chuzzle`,o=o=="☆"?"★":"☆"},1e3)}{const[o,e,n]=g("background",SVGGElement).querySelectorAll("circle");o.animate([{transform:"rotate(720deg)"},{transform:"rotate(0deg)"}],{duration:67973,easing:"ease",iterations:1/0}),e.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:19701,easing:"cubic-bezier(0.42, 0, 0.32, 1.83)",iterations:1/0}),n.animate(m.flatMap((t,r)=>[{fill:t,opacity:0,offset:r/m.length},{fill:t,opacity:.15,offset:(r+.25)/m.length},{fill:t,opacity:.15,offset:(r+.75)/m.length},{fill:t,opacity:0,offset:(r+1)/m.length}]),{duration:4e3*m.length,iterations:1/0})}be(new h(Me));
