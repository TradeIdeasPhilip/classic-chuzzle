(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var h={},i={};Object.defineProperty(i,"__esModule",{value:!0});i.permutations=i.polarToRectangular=i.makeBoundedLinear=T=i.makeLinear=i.sum=i.countMap=g=i.initializedArray=i.count=i.zip=i.FIGURE_SPACE=i.NON_BREAKING_SPACE=i.dateIsValid=i.MIN_DATE=i.MAX_DATE=i.makePromise=i.filterMap=v=i.pick=i.pickAny=i.csvStringToArray=i.parseTimeT=i.parseIntX=i.parseFloatX=i.getAttribute=i.followPath=i.parseXml=i.testXml=L=i.sleep=i.assertClass=void 0;function V(o,e,t="Assertion Failed."){const n=r=>{throw new Error(`${t}  Expected type:  ${e.name}.  Found type:  ${r}.`)};if(o===null)n("null");else if(typeof o!="object")n(typeof o);else if(!(o instanceof e))n(o.constructor.name);else return o;throw new Error("wtf")}i.assertClass=V;function j(o){return new Promise(e=>setTimeout(e,o))}var L=i.sleep=j;function O(o){const t=new DOMParser().parseFromString(o,"application/xml");for(const n of Array.from(t.querySelectorAll("parsererror")))if(n instanceof HTMLElement)return{error:n};return{parsed:t}}i.testXml=O;function q(o){if(o!==void 0)return O(o)?.parsed?.documentElement}i.parseXml=q;function F(o,...e){for(const t of e){if(o===void 0)return;if(typeof t=="number")o=o.children[t];else{const n=o.getElementsByTagName(t);if(n.length!=1)return;o=n[0]}}return o}i.followPath=F;function U(o,e,...t){if(e=F(e,...t),e!==void 0&&e.hasAttribute(o))return e.getAttribute(o)??void 0}i.getAttribute=U;function z(o){if(o==null)return;const e=parseFloat(o);if(isFinite(e))return e}i.parseFloatX=z;function D(o){const e=z(o);if(e!==void 0)return e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER||e!=Math.floor(e)?void 0:e}i.parseIntX=D;function K(o){if(typeof o=="string"&&(o=D(o)),o!=null&&!(o<=0))return new Date(o*1e3)}i.parseTimeT=K;const Y=o=>{const e=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,t=[[]];let n;for(;n=e.exec(o);)n[1].length&&n[1]!==","&&t.push([]),t[t.length-1].push(n[2]!==void 0?n[2].replace(/""/g,'"'):n[3]);return t};i.csvStringToArray=Y;function J(o){const e=o.values().next();if(!e.done)return e.value}i.pickAny=J;function Q(o){return o[Math.random()*o.length|0]}var v=i.pick=Q;function W(o,e){const t=[];return o.forEach((n,r)=>{const s=e(n,r);s!==void 0&&t.push(s)}),t}i.filterMap=W;function ee(){let o,e;return{promise:new Promise((n,r)=>{o=n,e=r}),resolve:o,reject:e}}i.makePromise=ee;i.MAX_DATE=new Date(864e13);i.MIN_DATE=new Date(-864e13);function te(o){return isFinite(o.getTime())}i.dateIsValid=te;i.NON_BREAKING_SPACE=" ";i.FIGURE_SPACE=" ";function*ne(...o){const e=o.map(t=>t[Symbol.iterator]());for(;;){const t=e.map(n=>n.next());if(t.some(({done:n})=>n))break;yield t.map(({value:n})=>n)}}i.zip=ne;function*oe(o=0,e=1/0,t=1){for(let n=o;n<e;n+=t)yield n}i.count=oe;function N(o,e){const t=[];for(let n=0;n<o;n++)t.push(e(n));return t}var g=i.initializedArray=N;i.countMap=N;function re(o){return o.reduce((e,t)=>e+t,0)}i.sum=re;function se(o,e,t,n){const r=(n-e)/(t-o);return function(s){return(s-o)*r+e}}var T=i.makeLinear=se;function ae(o,e,t,n){t<o&&([o,e,t,n]=[t,n,o,e]);const r=(n-e)/(t-o);return function(s){return s<=o?e:s>=t?n:(s-o)*r+e}}i.makeBoundedLinear=ae;function ie(o,e){return{x:Math.sin(e)*o,y:Math.cos(e)*o}}i.polarToRectangular=ie;function*$(o,e=[]){if(o.length==0)yield e;else for(let t=0;t<o.length;t++){const n=o[t],r=[...e,n],s=[...o.slice(0,t),...o.slice(t+1)];yield*$(s,r)}}i.permutations=$;Object.defineProperty(h,"__esModule",{value:!0});h.download=h.createElementFromHTML=h.getHashInfo=h.getAudioBalanceControl=h.getBlobFromCanvas=h.loadDateTimeLocal=w=h.getById=void 0;const B=i;function ce(o,e){const t=document.getElementById(o);if(!t)throw new Error("Could not find element with id "+o+".  Expected type:  "+e.name);if(t instanceof e)return t;throw new Error("Element with id "+o+" has type "+t.constructor.name+".  Expected type:  "+e.name)}var w=h.getById=ce;function le(o,e,t="milliseconds"){let n;switch(t){case"minutes":{n=e.getSeconds()*1e3+e.getMilliseconds();break}case"seconds":{n=e.getMilliseconds();break}case"milliseconds":{n=0;break}default:throw new Error("wtf")}o.valueAsNumber=+e-e.getTimezoneOffset()*6e4-n}h.loadDateTimeLocal=le;function ue(o){const{reject:e,resolve:t,promise:n}=(0,B.makePromise)();return o.toBlob(r=>{r?t(r):e(new Error("blob is null!"))}),n}h.getBlobFromCanvas=ue;function de(o){const e=new AudioContext,t=e.createMediaElementSource(o),n=new StereoPannerNode(e,{pan:0});return t.connect(n).connect(e.destination),r=>{n.pan.value=r}}h.getAudioBalanceControl=de;function fe(){const o=new Map;return/^#?(.*)$/.exec(location.hash.replace("+","%20"))[1].split("&").forEach(n=>{const r=n.split("=",2);if(r.length==2){const s=decodeURIComponent(r[0]),a=decodeURIComponent(r[1]);o.set(s,a)}}),o}h.getHashInfo=fe;function he(o,e){var t=document.createElement("div");return t.innerHTML=o.trim(),(0,B.assertClass)(t.firstChild,e,"createElementFromHTML:")}h.createElementFromHTML=he;function me(o,e){var t=document.createElement("a");if(t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",o),document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),t.dispatchEvent(n)}else t.click()}h.download=me;class pe{#e=new Set;get contents(){return[...this.#e].map(e=>e.piece)}get size(){return this.#e.size}debugInitialCell;color;constructor(e){this.color=e.color,this.debugInitialCell=e,this.#e.add(e)}consume(e){const t=this.#e,n=e.#e;return n.forEach(r=>t.add(r)),e.#e=void 0,n}get valid(){return!!this.#e?.has(this.debugInitialCell)}}class P{constructor(e){this.piece=e,this.#e=new pe(this)}#e;get color(){return this.piece.color}static createAll(e){return e.map(t=>t.map(n=>new P(n)))}tryCombine(e){if(this.#e!=e.#e&&this.color==e.color&&(this.#e.consume(e.#e).forEach(n=>n.#e=this.#e),!this.#e.valid))throw new Error("wtf")}static combineAll(e){e.forEach((t,n)=>{t.forEach((r,s)=>{if(n){const a=n-1,c=e[a][s];r.tryCombine(c)}if(s){const a=s-1,c=t[a];r.tryCombine(c)}})})}static findBigGroups(e){const t=new Map;e.forEach(r=>r.forEach(s=>{const a=s.#e,c=t.get(a)??0;t.set(a,c+1)}));const n=[];for(const[r,s]of t)s>=3&&n.push(r);return n}static findActionable(e){const t=this.createAll(e);return this.combineAll(t),this.findBigGroups(t)}}function k(o){return P.findActionable(o).map(e=>e.contents)}function y(o,e){const t=o%e;return t<0?t+Math.abs(e):t}function ge(o,e){if((e|0)!=e)throw new Error(`invalid input: ${e}`);return e=y(e,o.length),e==0?o:[...o.slice(e),...o.slice(0,e)]}function I(o,e,t="Assertion Failed."){const n=r=>{throw new Error(`${t}  Expected type:  ${e.name}.  Found type:  ${r}.`)};if(o===null)n("null");else if(typeof o!="object")n(typeof o);else if(!(o instanceof e))n(o.constructor.name);else return o;throw new Error("wtf")}const A=o=>y(Math.round(o),d.SIZE),R=o=>y(o+.5,d.SIZE)-.5;function we(o,e,t){const n=o[e],r=ge(n,t);return n==r?o:o.map(s=>s==n?r:s)}function Ee(o,e,t){const n=o.length;return t=y(t,n),t==0?o:o.map((r,s)=>{const a=[...r];return a[e]=o[(s+t)%n][e],a})}const H=["red","green","blue","yellow","orange","violet"];class C{constructor(e,t,n){this.color=n,this.#t=e,this.#n=t}async remove(){}weight=1;#e=!1;isBomb(){return this.#e}makeBomb(){this.#e=!0}#t;#n;static randomColor(){return v(H)}get row(){return this.#t}get column(){return this.#n}moveToImmediately(e,t){this.#t=e,this.#n=t}moveToAnimated(e,t){return this.moveToImmediately(e,t),Promise.resolve()}}class d{constructor(e){this.animator=e,this.#e=this.createRandom()}static SIZE=6;#e;getColumn(e){return this.#e.map(t=>t[e])}createRandomPiece(e,t){return this.animator.createPiece(e,t,C.randomColor())}createRandom(){const e=g(d.SIZE,n=>g(d.SIZE,r=>new C(n,r,C.randomColor())));return k(e).forEach(n=>{n.forEach(({row:r,column:s})=>{const a=new Set;[[0,1],[0,-1],[1,0],[-1,0]].forEach(([c,l])=>{const u=e[r+c];if(u){const f=u[s+l];f&&a.add(f.color)}}),e[r][s]=new C(r,s,v(H.filter(c=>!a.has(c))))})}),e.map(n=>n.map(r=>this.animator.createPiece(r.row,r.column,r.color)))}async updateLoop(e,t){for(let n=1;e.length>0;n++)await t.addToScore(n),await this.removeGroups(e),e=k(this.#e),t=this.animator.assignGroupDecorations(e),t.highlightGroups()}setAllPieces(e){this.#e=e,e.forEach((t,n)=>{t.forEach((r,s)=>{r.moveToImmediately(n,s)})})}startHorizontalMove(e){const t=g(d.SIZE,s=>{const a=we(this.#e,e,-s),c=k(a);return{actions:this.animator.assignGroupDecorations(c),groups:c,pieces:a}}),n=s=>{this.#e[e].forEach((c,l)=>c.moveToImmediately(e,R(l+s))),t[A(s)].actions.highlightGroups()};return{preview:n,release:async s=>{n(s);const a=A(s),l=t[a].groups.length==0?0:a,u=this.#e[e];await this.animator.rotateRight(u,l-s);const f=t[l];this.setAllPieces(f.pieces),await this.updateLoop(f.groups,f.actions)}}}startVerticalMove(e){const t=g(d.SIZE,s=>{const a=Ee(this.#e,e,-s),c=k(a);return{actions:this.animator.assignGroupDecorations(c),groups:c,pieces:a}}),n=s=>{this.getColumn(e).forEach((c,l)=>c.moveToImmediately(R(l+s),e)),t[A(s)].actions.highlightGroups()};return{preview:n,release:async s=>{n(s);const a=A(s),l=t[a].groups.length==0?0:a,u=this.getColumn(e);await this.animator.rotateDown(u,l-s);const f=t[l];this.#e=f.pieces,this.setAllPieces(f.pieces),await this.updateLoop(f.groups,f.actions)}}}async removeGroups(e){const t=g(d.SIZE,()=>new Set),n=[];e.forEach(s=>{s.forEach(({row:a,column:c})=>{const l=t[c];if(l.has(a))throw new Error("wtf");l.add(a),n.push(this.#e[a][c].remove())})}),await Promise.all(n),n.length=0;const r=g(d.SIZE,()=>new Array(d.SIZE));t.forEach((s,a)=>{const c=[];for(let l=0;l<d.SIZE;l++)s.has(l)||c.push(this.#e[l][a]);for(let l=0;c.length<d.SIZE;l++){const u=-1-l,f=this.createRandomPiece(u,a);c.unshift(f)}c.forEach((l,u)=>{r[u][a]=l,n.push(l.moveToAnimated(u,a))})}),this.setAllPieces(r),await Promise.all(n)}}const b=w("newScore",HTMLDivElement),G=w("chainBonus",HTMLDivElement),ve=new Map([["orange",["cyan","brown","white","darkviolet","lightyellow","darkgreen","darkolivegreen","darkred"]],["yellow",["brown","darkviolet","lightcoral","lightsalmon","lightseagreen","darkblue","darkcyan","darkgoldenrod","darkgreen","darkkhaki","darkolivegreen","darkorange","darkred","darksalmon","darkseagreen"]],["violet",["cyan","brown","white","darkviolet","lightgreen","darkblue"]],["blue",["cyan","white","lightcoral","lightgreen","lightgray","lightsalmon","lightseagreen","lightseagreen","lightskyblue","lightslategray","darkorange","darkseagreen","darkturquoise"]],["red",["cyan","white","lightcoral","lightgreen","lightsalmon","darkkhaki","darkseagreen","chartreuse"]],["green",["cyan","white","lightcoral","lightcyan","lightgreen","lightyellow","darkred","darkseagreen","chartreuse"]]]),ye=["ʻ","☆","𝛿","∞","•","⭑","†","‡","؟","༗","ၯ","◦","§","_","ɝ","Ԕ","⟳","⚐","🜚","愛","❝","ℵ","を","ᇸ","ڰ","ॾ","ৼ","ན","ᛧ","ß","⧕","↯","➷","⅋","☙","„","⌥","⧷","⁎","╕","₰","…","⑈","۽","ₜ","ಠ","෴","ጃ","ᔱ","ᔰ","Ѧ","ᑥ","𝄢","ƈ","Ɣ","ƕ","Ɋ","ɕ","ɮ","ʆ","Ξ","Ж","Ѭ","Զ","ঔ","ਐ","ઝ","ଈ","ஜ","ధ","ൠ","ඊ","ጯ","ᡀ","‰","₻","↉","↜","↸","⋨","⌤","⎌","⍾","☏","✗","➘","〷","ご","ᇌ","㊤","﹆","🜇","🝤"];function X(o){return{duration:Math.abs(o)*2e3/d.SIZE}}const _=w("board",SVGElement);function Z(){_.querySelectorAll("text.crystal-decoration").forEach(o=>o.textContent="")}class p extends C{static#e=w("piece",HTMLTemplateElement).content.querySelector("g");element;decorationElement;static#t=CSS.px(Math.E);static#n=CSS.px(Math.PI);static#o=new CSSTransformValue([new CSSTranslate(this.#t,this.#n)]);updatePositionOnScreen(){p.#t.value=this.column,p.#n.value=this.row,this.element.attributeStyleMap.set("transform",p.#o)}moveToImmediately(e,t){super.moveToImmediately(e,t),this.updatePositionOnScreen()}moveToAnimated(e,t,n){const r=this.column,s=this.row;if(!n){const l=Math.hypot(e-s,t-r);n=X(l)}super.moveToImmediately(e,t);const a=this.element;return a.parentElement?.appendChild(a),a.animate([{transform:`translate(${r}px, ${s}px)`},{transform:`translate(${t}px, ${e}px)`}],n).finished}constructor(e,t,n){super(e,t,n);const r=I(p.#e.cloneNode(!0),SVGGElement);this.element=r,this.decorationElement=r.querySelector("text.crystal-decoration"),r.setAttribute("fill",n),_.appendChild(r),this.updatePositionOnScreen()}async remove(){let e,t;e=Math.random()*(d.SIZE/2-1),t=Math.random()*(d.SIZE/2-1);{const n=Math.random()*3;n>1&&(e-=d.SIZE/2),n<2&&(t-=d.SIZE/2)}{const n=r=>Math.random()>(r+1)/(d.SIZE+1);n(this.row)&&(e=d.SIZE-e-1),n(this.column)&&(t=d.SIZE-t-1)}await this.moveToAnimated(e,t,{duration:1e3,easing:"ease-in"}),this.element.remove(),this.element="💀"}}const x=o=>{const e=y(o+d.SIZE/2,d.SIZE)-d.SIZE/2,t=X(e);return{makeScript:r=>{const s=[r],a=[0],c=y(Math.round(r+e),d.SIZE);if(c>5.1)throw new Error("wtf");const l=(u,f)=>{s.push(u,f);const m=Math.abs(r-u),S=Math.abs(f-c),M=m+S,E=m/M;a.push(E,E)};return Math.sign(e)==-1?c>r&&l(-.5,d.SIZE-.5):c<r&&l(d.SIZE-.5,-.5),s.push(c),a.push(1),{position:s,offset:a,finalPosition:c}},options:t}};class Se{createPiece(e,t,n){return new p(e,t,n)}async rotateDown(e,t){const{makeScript:n,options:r}=x(t),s=[];e.forEach(a=>{const{position:c,offset:l}=n(a.row),u=c.map(f=>`translate(${a.column}px, ${f}px)`);s.push(I(a,p).element.animate({transform:u,offset:l},r).finished)}),await Promise.all(s)}async rotateRight(e,t){const{makeScript:n,options:r}=x(t),s=[];e.forEach(a=>{const{position:c,offset:l}=n(a.column),u=c.map(f=>`translate(${f}px, ${a.row}px)`);s.push(I(a,p).element.animate({transform:u,offset:l},r).finished)}),await Promise.all(s)}assignGroupDecorations(e){if(e.length==0)return{addToScore(){return Promise.resolve()},highlightGroups(){Z()}};{const t=[...ye],n=e.map(r=>{const s=v(ve.get(r[0].color)),a=Math.floor(Math.random()*t.length),c=t[a];return t.splice(a,1),{pieces:r,decorationColor:s,decorationText:c}});return{async addToScore(r){e.forEach(s=>{const a=s.map(m=>I(m,p)),c=1,u=[{opacity:Math.random()*.2+.05},{opacity:c}],f={direction:v(["alternate","alternate-reverse","normal","reverse"]),duration:550+Math.random()*150,easing:v(["linear","ease-in","ease-out","ease-in-out"]),iterationStart:Math.random(),iterations:1/0};a.forEach(m=>{m.decorationElement.animate(u,f)})}),r<2?G.innerHTML="":G.innerText=`Chain Bonus: ⨉ ${r}`,b.innerHTML="",n.forEach(({pieces:s,decorationColor:a,decorationText:c},l)=>{l>0&&b.append(" + ");const u=document.createElement("span");u.innerText=`${c} ${s.length}`,u.style.color=a,u.style.borderColor=u.style.backgroundColor=s[0].color,u.classList.add("individualScore"),b.appendChild(u)}),await L(2e3)},highlightGroups(){Z(),n.forEach(({pieces:r,decorationColor:s,decorationText:a})=>{r.forEach(c=>{const u=I(c,p).decorationElement;u.textContent=a,u.style.fill=s})})}}}}}const Me=new Se;function Ie(o){const e=w("main",SVGSVGElement);function t(r){const s=e.getBoundingClientRect(),a=T(s.top,0,s.bottom,d.SIZE),c=T(s.left,0,s.right,d.SIZE);return{row:a(r.clientY),column:c(r.clientX)}}let n={state:"none"};e.addEventListener("pointerdown",r=>{if(n.state=="none"){r.stopPropagation(),e.setPointerCapture(r.pointerId);const s=t(r);e.style.cursor="move",n={state:"started",startRow:s.row,startColumn:s.column}}}),e.addEventListener("pointermove",r=>{if(n.state=="none"||n.state=="animation")return;r.stopPropagation();const s=t(r);if(n.state=="started"){const a=Math.abs(s.row-n.startRow),c=Math.abs(s.column-n.startColumn);if(Math.max(a,c)<.05)return;if(a>c){const l="vertical",u=Math.floor(n.startColumn),f=n.startRow,m=M=>{const{row:E}=t(M);return E-f},S=o.startVerticalMove(u);n={state:l,fixedIndex:u,startIndex:f,relevantMouseMove:m,actions:S},e.style.cursor="ns-resize"}else if(c>a){const l="horizontal",u=Math.floor(n.startRow),f=n.startColumn,m=M=>{const{column:E}=t(M);return E-f},S=o.startHorizontalMove(u);n={state:l,fixedIndex:u,startIndex:f,relevantMouseMove:m,actions:S},e.style.cursor="ew-resize"}else return}n.actions.preview(n.relevantMouseMove(r))}),e.addEventListener("lostpointercapture",async r=>{switch(n.state){case"started":break;case"horizontal":case"vertical":{e.style.cursor="none";const s=n;n={state:"animation"},await s.actions.release(s.relevantMouseMove(r));break}default:throw new Error("wtf")}n={state:"none"},e.style.cursor=""})}{let o="☆";setInterval(()=>{document.title=`${o} Classic Chuzzle`,o=o=="☆"?"★":"☆"},1e3)}{const[o,e]=w("background",SVGGElement).querySelectorAll("circle");o.animate([{transform:"rotate(720deg)"},{transform:"rotate(0deg)"}],{duration:67973,easing:"ease",iterations:1/0}),e.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:19701,easing:"cubic-bezier(0.42, 0, 0.32, 1.83)",iterations:1/0})}Ie(new d(Me));
