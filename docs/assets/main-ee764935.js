(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();var m={},c={};Object.defineProperty(c,"__esModule",{value:!0});c.permutations=c.polarToRectangular=c.makeBoundedLinear=b=c.makeLinear=c.sum=c.countMap=g=c.initializedArray=c.count=c.zip=c.FIGURE_SPACE=c.NON_BREAKING_SPACE=c.dateIsValid=c.MIN_DATE=c.MAX_DATE=c.makePromise=c.filterMap=E=c.pick=c.pickAny=c.csvStringToArray=c.parseTimeT=c.parseIntX=c.parseFloatX=c.getAttribute=c.followPath=c.parseXml=c.testXml=$=c.sleep=c.assertClass=void 0;function K(o,t,e="Assertion Failed."){const n=r=>{throw new Error(`${e}  Expected type:  ${t.name}.  Found type:  ${r}.`)};if(o===null)n("null");else if(typeof o!="object")n(typeof o);else if(!(o instanceof t))n(o.constructor.name);else return o;throw new Error("wtf")}c.assertClass=K;function W(o){return new Promise(t=>setTimeout(t,o))}var $=c.sleep=W;function L(o){const e=new DOMParser().parseFromString(o,"application/xml");for(const n of Array.from(e.querySelectorAll("parsererror")))if(n instanceof HTMLElement)return{error:n};return{parsed:e}}c.testXml=L;function Q(o){if(o!==void 0)return L(o)?.parsed?.documentElement}c.parseXml=Q;function z(o,...t){for(const e of t){if(o===void 0)return;if(typeof e=="number")o=o.children[e];else{const n=o.getElementsByTagName(e);if(n.length!=1)return;o=n[0]}}return o}c.followPath=z;function Y(o,t,...e){if(t=z(t,...e),t!==void 0&&t.hasAttribute(o))return t.getAttribute(o)??void 0}c.getAttribute=Y;function O(o){if(o==null)return;const t=parseFloat(o);if(isFinite(t))return t}c.parseFloatX=O;function B(o){const t=O(o);if(t!==void 0)return t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER||t!=Math.floor(t)?void 0:t}c.parseIntX=B;function J(o){if(typeof o=="string"&&(o=B(o)),o!=null&&!(o<=0))return new Date(o*1e3)}c.parseTimeT=J;const tt=o=>{const t=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,e=[[]];let n;for(;n=t.exec(o);)n[1].length&&n[1]!==","&&e.push([]),e[e.length-1].push(n[2]!==void 0?n[2].replace(/""/g,'"'):n[3]);return e};c.csvStringToArray=tt;function et(o){const t=o.values().next();if(!t.done)return t.value}c.pickAny=et;function nt(o){return o[Math.random()*o.length|0]}var E=c.pick=nt;function ot(o,t){const e=[];return o.forEach((n,r)=>{const s=t(n,r);s!==void 0&&e.push(s)}),e}c.filterMap=ot;function rt(){let o,t;return{promise:new Promise((n,r)=>{o=n,t=r}),resolve:o,reject:t}}c.makePromise=rt;c.MAX_DATE=new Date(864e13);c.MIN_DATE=new Date(-864e13);function st(o){return isFinite(o.getTime())}c.dateIsValid=st;c.NON_BREAKING_SPACE=" ";c.FIGURE_SPACE=" ";function*it(...o){const t=o.map(e=>e[Symbol.iterator]());for(;;){const e=t.map(n=>n.next());if(e.some(({done:n})=>n))break;yield e.map(({value:n})=>n)}}c.zip=it;function*at(o=0,t=1/0,e=1){for(let n=o;n<t;n+=e)yield n}c.count=at;function Z(o,t){const e=[];for(let n=0;n<o;n++)e.push(t(n));return e}var g=c.initializedArray=Z;c.countMap=Z;function lt(o){return o.reduce((t,e)=>t+e,0)}c.sum=lt;function ct(o,t,e,n){const r=(n-t)/(e-o);return function(s){return(s-o)*r+t}}var b=c.makeLinear=ct;function ut(o,t,e,n){e<o&&([o,t,e,n]=[e,n,o,t]);const r=(n-t)/(e-o);return function(s){return s<=o?t:s>=e?n:(s-o)*r+t}}c.makeBoundedLinear=ut;function dt(o,t){return{x:Math.sin(t)*o,y:Math.cos(t)*o}}c.polarToRectangular=dt;function*V(o,t=[]){if(o.length==0)yield t;else for(let e=0;e<o.length;e++){const n=o[e],r=[...t,n],s=[...o.slice(0,e),...o.slice(e+1)];yield*V(s,r)}}c.permutations=V;Object.defineProperty(m,"__esModule",{value:!0});m.download=m.createElementFromHTML=m.getHashInfo=m.getAudioBalanceControl=m.getBlobFromCanvas=m.loadDateTimeLocal=p=m.getById=void 0;const H=c;function ft(o,t){const e=document.getElementById(o);if(!e)throw new Error("Could not find element with id "+o+".  Expected type:  "+t.name);if(e instanceof t)return e;throw new Error("Element with id "+o+" has type "+e.constructor.name+".  Expected type:  "+t.name)}var p=m.getById=ft;function ht(o,t,e="milliseconds"){let n;switch(e){case"minutes":{n=t.getSeconds()*1e3+t.getMilliseconds();break}case"seconds":{n=t.getMilliseconds();break}case"milliseconds":{n=0;break}default:throw new Error("wtf")}o.valueAsNumber=+t-t.getTimezoneOffset()*6e4-n}m.loadDateTimeLocal=ht;function mt(o){const{reject:t,resolve:e,promise:n}=(0,H.makePromise)();return o.toBlob(r=>{r?e(r):t(new Error("blob is null!"))}),n}m.getBlobFromCanvas=mt;function pt(o){const t=new AudioContext,e=t.createMediaElementSource(o),n=new StereoPannerNode(t,{pan:0});return e.connect(n).connect(t.destination),r=>{n.pan.value=r}}m.getAudioBalanceControl=pt;function gt(){const o=new Map;return/^#?(.*)$/.exec(location.hash.replace("+","%20"))[1].split("&").forEach(n=>{const r=n.split("=",2);if(r.length==2){const s=decodeURIComponent(r[0]),i=decodeURIComponent(r[1]);o.set(s,i)}}),o}m.getHashInfo=gt;function yt(o,t){var e=document.createElement("div");return e.innerHTML=o.trim(),(0,H.assertClass)(e.firstChild,t,"createElementFromHTML:")}m.createElementFromHTML=yt;function wt(o,t){var e=document.createElement("a");if(e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download",o),document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),e.dispatchEvent(n)}else e.click()}m.download=wt;class Et{#t=new Set;get contents(){return[...this.#t].map(t=>t.piece)}get size(){return this.#t.size}debugInitialCell;color;constructor(t){this.color=t.color,this.debugInitialCell=t,this.#t.add(t)}consume(t){const e=this.#t,n=t.#t;return n.forEach(r=>e.add(r)),t.#t=void 0,n}get valid(){return!!this.#t?.has(this.debugInitialCell)}}class P{constructor(t){this.piece=t,this.#t=new Et(this)}#t;get color(){return this.piece.color}static createAll(t){return t.map(e=>e.map(n=>new P(n)))}tryCombine(t){if(this.#t!=t.#t&&this.color==t.color&&(this.#t.consume(t.#t).forEach(n=>n.#t=this.#t),!this.#t.valid))throw new Error("wtf")}static combineAll(t){t.forEach((e,n)=>{e.forEach((r,s)=>{if(n){const i=n-1,a=t[i][s];r.tryCombine(a)}if(s){const i=s-1,a=e[i];r.tryCombine(a)}})})}static findBigGroups(t){const e=new Map;t.forEach(r=>r.forEach(s=>{const i=s.#t,a=e.get(i)??0;e.set(i,a+1)}));const n=[];for(const[r,s]of e)s>=3&&n.push(r);return n}static findActionable(t){const e=this.createAll(t);return this.combineAll(e),this.findBigGroups(e)}}function x(o){return P.findActionable(o).map(t=>t.contents)}function M(o,t){const e=o%t;return e<0?e+Math.abs(t):e}function bt(o,t){if((t|0)!=t)throw new Error(`invalid input: ${t}`);return t=M(t,o.length),t==0?o:[...o.slice(t),...o.slice(0,t)]}function X(o,t,e="Assertion Failed."){const n=r=>{throw new Error(`${e}  Expected type:  ${t.name}.  Found type:  ${r}.`)};if(o===null)n("null");else if(typeof o!="object")n(typeof o);else if(!(o instanceof t))n(o.constructor.name);else return o;throw new Error("wtf")}function j(o,t){return{x:Math.cos(t)*o,y:Math.sin(t)*o}}const C=o=>M(Math.round(o),f.SIZE);function vt(o,t,e){const n=o[t],r=bt(n,e);return n==r?o:o.map(s=>s==n?r:s)}function It(o,t,e){const n=o.length;return e=M(e,n),e==0?o:o.map((r,s)=>{const i=[...r];return i[t]=o[(s+e)%n][t],i})}const w=["red","green","blue","yellow","orange","violet"];class S{constructor(t,e,n=S.randomColor()){this.rowIndex=t,this.columnIndex=e,this.color=n}weight=1;bomb=!1;static randomColor(){return E(w)}}class f{constructor(t){this.animator=t,this.#t=this.createRandom(),this.#t.forEach(e=>e.forEach(n=>this.animator.initializePiece(n)))}static SIZE=6;#t;getColumn(t){return this.#t.map(e=>e[t])}createRandom(){const t=g(f.SIZE,n=>g(f.SIZE,r=>new S(n,r)));return x(t).forEach(n=>{n.forEach(({rowIndex:r,columnIndex:s})=>{const i=new Set;[[0,1],[0,-1],[1,0],[-1,0]].forEach(([a,l])=>{const u=t[r+a];if(u){const d=u[s+l];d&&i.add(d.color)}}),t[r][s]=new S(r,s,E(w.filter(a=>!i.has(a))))})}),t}async updateLoop(t,e){for(let n=1;t.length>0;n++){const r=new Set,s=[];t.forEach(i=>{if(i.length==5){const a=E(i);a.bomb=!0,r.add(a),this.animator.updateBomb(a),s.push(a)}}),await e.addToScore(n),s.forEach(i=>this.animator.cancelGroup(i)),await this.removePieces(t.flatMap(i=>i.filter(a=>!r.has(a)))),t=x(this.#t),e=this.animator.assignGroupDecorations(t),e.highlightGroups()}}setAllPieces(t){this.#t=t,t.forEach((e,n)=>{e.forEach((r,s)=>{r.columnIndex=s,r.rowIndex=n})})}startHorizontalMove(t){const e=g(f.SIZE,s=>{const i=vt(this.#t,t,-s),a=x(i);return{actions:this.animator.assignGroupDecorations(a),groups:a,pieces:i}}),n=s=>{const i=this.#t[t];this.animator.drawPreview("horizontal",i,s),e[C(s)].actions.highlightGroups()};return{preview:n,release:async s=>{n(s);const i=C(s),l=e[i].groups.length==0?0:i,u=e[l];this.setAllPieces(u.pieces);const d=this.#t[t];await this.animator.rotateTo("horizontal",d),await this.updateLoop(u.groups,u.actions)}}}startVerticalMove(t){const e=g(f.SIZE,s=>{const i=It(this.#t,t,-s),a=x(i);return{actions:this.animator.assignGroupDecorations(a),groups:a,pieces:i}}),n=s=>{const i=this.getColumn(t);this.animator.drawPreview("vertical",i,s),e[C(s)].actions.highlightGroups()};return{preview:n,release:async s=>{n(s);const i=C(s),l=e[i].groups.length==0?0:i,u=e[l];this.setAllPieces(u.pieces);const d=this.getColumn(t);await this.animator.rotateTo("vertical",d),await this.updateLoop(u.groups,u.actions)}}}async removePieces(t){const e=g(f.SIZE,()=>new Set);{const s=t.map(({rowIndex:i,columnIndex:a})=>{const l=e[a];if(l.has(i))throw new Error("wtf");return l.add(i),this.animator.destroyPiece(this.#t[i][a])});await Promise.all(s)}const n=g(f.SIZE,()=>new Array(f.SIZE)),r=[];e.forEach((s,i)=>{const a=[];for(let l=0;l<f.SIZE;l++)s.has(l)||a.push(this.#t[l][i]);for(let l=0;a.length<f.SIZE;l++){const u=-1-l,d=new S(u,i);this.animator.initializePiece(d),a.unshift(d)}a.forEach((l,u)=>{n[u][i]=l,l.columnIndex=i,l.rowIndex=u,r.push(l)})}),await Promise.all(r.map(s=>this.animator.slideTo(s))),this.setAllPieces(n)}}const T=p("newScore",HTMLDivElement),N=p("chainBonus",HTMLDivElement),_=new Map([["orange",["cyan","brown","white","darkviolet","lightyellow","darkgreen","darkolivegreen","darkred"]],["yellow",["brown","darkviolet","lightcoral","lightsalmon","lightseagreen","darkblue","darkcyan","darkgoldenrod","darkgreen","darkkhaki","darkolivegreen","darkorange","darkred","darksalmon","darkseagreen"]],["violet",["cyan","brown","white","darkviolet","lightgreen","darkblue"]],["blue",["cyan","white","lightcoral","lightgreen","lightgray","lightsalmon","lightseagreen","lightseagreen","lightskyblue","lightslategray","darkorange","darkseagreen","darkturquoise"]],["red",["cyan","white","lightcoral","lightgreen","lightsalmon","darkkhaki","darkseagreen","chartreuse"]],["green",["cyan","white","lightcoral","lightcyan","lightgreen","lightyellow","darkred","darkseagreen","chartreuse"]]]),St=["ʻ","☆","𝛿","∞","•","⭑","†","‡","؟","༗","ၯ","◦","§","_","ɝ","Ԕ","⟳","⚐","🜚","愛","❝","ℵ","を","ᇸ","ڰ","ॾ","ৼ","ན","ᛧ","ß","⧕","↯","➷","⅋","☙","„","⌥","⧷","⁎","╕","₰","…","⑈","۽","ₜ","ಠ","෴","ጃ","ᔱ","ᔰ","Ѧ","ᑥ","𝄢","ƈ","Ɣ","ƕ","Ɋ","ɕ","ɮ","ʆ","Ξ","Ж","Ѭ","Զ","ঔ","ਐ","ઝ","ଈ","ஜ","ధ","ൠ","ඊ","ጯ","ᡀ","‰","₻","↉","↜","↸","⋨","⌤","⎌","⍾","☏","✗","➘","〷","ご","ᇌ","㊤","﹆","🜇","🝤"];let A=1;function R(o){return{duration:Math.abs(o)*2e3/f.SIZE*A}}const q=p("board",SVGElement);function F(){q.querySelectorAll("text.crystal-decoration,text.crystal-decoration-background").forEach(o=>o.textContent="")}class I{static#t=p("piece",HTMLTemplateElement).content.querySelector("g");element;decorationElement;decorationBackgroundElement;bombElement;get bombVisible(){return this.bombElement.style.display==""}set bombVisible(t){this.bombElement.style.display=t?"":"none"}static#o=CSS.px(Math.E);static#r=CSS.px(Math.PI);static#s=new CSSTransformValue([new CSSTranslate(this.#o,this.#r)]);updateFinalPosition(t){this.#n=t.columnIndex,this.#e=t.rowIndex,I.#o.value=t.columnIndex,I.#r.value=t.rowIndex,this.element.attributeStyleMap.set("transform",I.#s)}async slideDirectlyTo(t,e){const n=this.#n,r=this.#e;this.updateFinalPosition(t);const s=this.#n,i=this.#e;if(!e){const u=Math.hypot(i-r,s-n);e=R(u)}const a=this.element;a.parentElement?.appendChild(a),await a.animate([{transform:`translate(${n}px, ${r}px)`},{transform:`translate(${t.columnIndex}px, ${t.rowIndex}px)`}],e).finished}async rotateTo(t,e){const n=e=="horizontal",r=(()=>{const l=n?t.columnIndex-this.#n:t.rowIndex-this.#e,u=M(l+f.SIZE/2,f.SIZE)-f.SIZE/2;return R(Math.abs(u))})(),{position:s,offset:i}=n?D(this.#n,t.columnIndex):D(this.#e,t.rowIndex),a=s.map(l=>n?`translate(${l}px, ${t.rowIndex}px)`:`translate(${t.columnIndex}px, ${l}px)`);this.updateFinalPosition(t),await this.element.animate({transform:a,offset:i},r).finished}#e=NaN;#n=NaN;constructor(t){const e=X(I.#t.cloneNode(!0),SVGGElement);this.element=e,this.decorationElement=e.querySelector("text.crystal-decoration"),this.decorationBackgroundElement=e.querySelector("text.crystal-decoration-background"),this.bombElement=e.querySelector(".bomb"),e.style.fill=t.color,this.decorationBackgroundElement.style.stroke=t.color,this.bombElement.style.fill=E(_.get(t.color)),this.bombVisible=!1,this.updateFinalPosition(t),q.appendChild(e)}async remove(){let t,e;t=Math.random()*(f.SIZE/2-1),e=Math.random()*(f.SIZE/2-1);{const n=Math.random()*3;n>1&&(t-=f.SIZE/2),n<2&&(e-=f.SIZE/2)}{const n=r=>Math.random()>(r+1)/(f.SIZE+1);n(this.#e)&&(t=f.SIZE-t-1),n(this.#n)&&(e=f.SIZE-e-1)}await this.slideDirectlyTo({rowIndex:t,columnIndex:e},{duration:1e3,easing:"ease-in"}),this.element.remove(),this.element="💀"}}const G=o=>M(o+.5,f.SIZE)-.5,D=(o,t)=>{const e=[o],n=[0];if(Math.abs(o-t)>f.SIZE/2){const r=(s,i)=>{e.push(s,i);const a=Math.abs(o-s),l=Math.abs(i-t),u=a+l,d=a/u;n.push(d,d)};t>o?r(-.5,f.SIZE-.5):r(f.SIZE-.5,-.5)}return e.push(t),n.push(1),{position:e,offset:n}};class Mt{cancelGroup(t){const e=this.#t.get(t);e.element.getAnimations().forEach(n=>n.cancel()),e.decorationElement.textContent="",e.decorationBackgroundElement.textContent=""}#t=new Map;initializePiece(t){this.#t.set(t,new I(t))}destroyPiece(t){const e=this.#t.get(t);return this.#t.delete(t),e.remove()}jumpTo(t){this.#t.get(t).updateFinalPosition(t)}slideTo(t){return this.#t.get(t).slideDirectlyTo(t)}drawPreview(t,e,n){e.forEach(r=>{const s=this.#t.get(r);let{rowIndex:i,columnIndex:a}=r;t=="vertical"?i=G(i+n):a=G(a+n),s.updateFinalPosition({rowIndex:i,columnIndex:a})})}async rotateTo(t,e){const n=e.map(r=>this.#t.get(r).rotateTo(r,t));await Promise.all(n)}updateBomb(t){const e=this.#t.get(t);e.bombVisible=t.bomb}assignGroupDecorations(t){if(t.length==0)return{addToScore(){return Promise.resolve()},highlightGroups(){F()}};{const e=[...St],n=t.map(s=>{const i=s[0].color,a=E(_.get(i)),l=Math.floor(Math.random()*e.length),u=e[l];return e.splice(l,1),{guiPieces:s.map(h=>{const y=this.#t.get(h);if(y==null)throw new Error("wtf");return y}),decorationColor:a,decorationText:u,backgroundColor:i}}),r=s=>{A=Math.pow(.8,s-1)*.9+.1};return{async addToScore(s){r(s),n.forEach(({guiPieces:i})=>{const u=[{opacity:Math.random()*.2+.05},{opacity:1}],d={direction:E(["alternate","alternate-reverse","normal","reverse"]),duration:(550+Math.random()*150)*A,easing:E(["linear","ease-in","ease-out","ease-in-out"]),iterationStart:Math.random(),iterations:1/0};i.forEach(h=>{h.decorationElement.animate(u,d),h.decorationBackgroundElement.animate(u,d)})}),s<2?N.innerHTML="":N.innerText=`Chain Bonus: ⨉ ${s}`,T.innerHTML="",n.forEach(({guiPieces:i,decorationColor:a,decorationText:l,backgroundColor:u},d)=>{d>0&&T.append(" + ");const h=document.createElement("span");h.innerText=`${l} ${i.length}`,h.style.color=a,h.style.borderColor=h.style.backgroundColor=u,h.classList.add("individualScore"),T.appendChild(h)}),await $(2e3)},highlightGroups(){F(),n.forEach(({guiPieces:s,decorationColor:i,decorationText:a})=>{s.forEach(l=>{const u=l.decorationElement;u.textContent=a,u.style.fill=i,l.decorationBackgroundElement.textContent=a})})}}}}}const xt=new Mt,Ct=""+new URL("cursor-2110db60.svg",import.meta.url).href;function kt(o){const t=p("main",SVGSVGElement);function e(r){const s=t.getBoundingClientRect(),i=b(s.top,0,s.bottom,f.SIZE),a=b(s.left,0,s.right,f.SIZE);return{row:i(r.clientY),column:a(r.clientX)}}let n={state:"none"};t.addEventListener("pointerdown",r=>{if(n.state=="none"){r.stopPropagation(),t.setPointerCapture(r.pointerId);const s=e(r);t.style.cursor="move",n={state:"started",startRow:s.row,startColumn:s.column}}}),t.addEventListener("pointermove",r=>{if(n.state=="none"||n.state=="animation")return;r.stopPropagation();const s=e(r);if(n.state=="started"){const i=Math.abs(s.row-n.startRow),a=Math.abs(s.column-n.startColumn);if(Math.max(i,a)<.05)return;if(i>a){const l="vertical",u=Math.floor(n.startColumn),d=n.startRow,h=v=>{const{row:k}=e(v);return k-d},y=o.startVerticalMove(u);n={state:l,fixedIndex:u,startIndex:d,relevantMouseMove:h,actions:y},t.style.cursor="ns-resize"}else if(a>i){const l="horizontal",u=Math.floor(n.startRow),d=n.startColumn,h=v=>{const{column:k}=e(v);return k-d},y=o.startHorizontalMove(u);n={state:l,fixedIndex:u,startIndex:d,relevantMouseMove:h,actions:y},t.style.cursor="ew-resize"}else return}n.actions.preview(n.relevantMouseMove(r))}),t.addEventListener("lostpointercapture",async r=>{switch(n.state){case"started":break;case"horizontal":case"vertical":{t.style.cursor=`url("${Ct}"),none`;const s=n;n={state:"animation"},await s.actions.release(s.relevantMouseMove(r));break}default:throw new Error("wtf")}n={state:"none"},t.style.cursor="grab"})}function Tt(o,t,e){if(!(t>=0&&t<=1))throw new Error("Expected 0 ≤ t ≤ 1");const n=Math.max(0,t-e),r=o(n),s=Math.max(0,t+e),i=o(s),a=i.x-r.x,l=i.y-r.y;return a==0&&l==0?NaN:Math.atan2(l,a)}function U(o,t={}){const e=Math.ceil(t.numberOfSegments??10);if(e<1)throw new Error(`Invalid numberOfSegments: ${e}`);const n=.01/e,r=g(e+1,a=>{const l=a/e,u=o(l),d=Tt(o,l,n);return{t:l,point:u,direction:d}}),s=g(e,a=>[{from:r[a],to:r[a+1]}][0]);console.log({samples:r,segments:s});let i=`M ${s[0].from.point.x}, ${s[0].from.point.y}`;return s.forEach(a=>{const l=Gt({x0:a.from.point.x,y0:a.from.point.y,slope:Math.tan(a.from.direction)},{x0:a.to.point.x,y0:a.to.point.y,slope:Math.tan(a.to.direction)});l?i+=` Q ${l.x},${l.y}`:i+=" M",i+=` ${a.to.point.x},${a.to.point.y}`}),i}function At(o,t,e){const n=Pt(o,t,e);return U(n,{numberOfSegments:e*9.001002})}function Pt(o,t,e){const s={x:o.x-t.x,y:o.y-t.y},i=Math.hypot(s.x,s.y),a=b(0,i,1,0),l=Math.atan2(s.y,s.x),u=b(0,l,1,l+e*2*Math.PI);return function(d){const h=a(d),y=u(d),v=j(h,y);return{x:t.x+v.x,y:t.y+v.y}}}function Nt(o,t,e){const n=b(0,t,1,e);return r=>j(o,n(r))}function Rt(o,t){const e=b(0,o.x,1,t.x),n=b(0,o.y,1,t.y);return r=>({x:e(r),y:n(r)})}function Ft(o,t,...e){const n=a=>{const l={x:0,y:0};return e.forEach(u=>{const d=u(a);l.x+=d.x,l.y+=d.y}),l},r=n(0),s=n(1),i=Rt({x:o.x-r.x,y:o.y-r.y},{x:t.x-s.x,y:t.y-s.y});return e.push(i),console.log({desiredFrom:o,computedFrom:n(0),desiredTo:t,computedTo:n(1)}),n}function Gt(o,t){if(isNaN(o.slope)||isNaN(t.slope)||o.slope==t.slope)return;const e=o.slope==1/0||o.slope==-1/0,n=t.slope==1/0||t.slope==-1/0;if(e||n)return;const r=e?o.x0:n?t.x0:(t.y0-t.slope*t.x0-o.y0+o.slope*o.x0)/(o.slope-t.slope),s=e?t.slope*(r-t.x0)+t.y0:o.slope*(r-o.x0)+o.y0;return{x:r,y:s}}{let o="☆";setInterval(()=>{document.title=`${o} Classic Chuzzle`,o=o=="☆"?"★":"☆"},1e3)}{const[o,t,e]=p("background",SVGGElement).querySelectorAll("circle");o.animate([{transform:"rotate(720deg)"},{transform:"rotate(0deg)"}],{duration:67973,easing:"ease",iterations:1/0}),t.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:19701,easing:"cubic-bezier(0.42, 0, 0.32, 1.83)",iterations:1/0}),e.animate(w.flatMap((n,r)=>[{fill:n,opacity:0,offset:r/w.length},{fill:n,opacity:.15,offset:(r+.25)/w.length},{fill:n,opacity:.15,offset:(r+.75)/w.length},{fill:n,opacity:0,offset:(r+1)/w.length}]),{duration:4e3*w.length,iterations:1/0})}p("main",SVGSVGElement).animate({backgroundColor:["#404040","#C0C0C0","#404040"]},{duration:97531,direction:"alternate",iterations:1/0});kt(new f(xt));{const o=p("main",SVGSVGElement),t=()=>{const e=p("piece",HTMLTemplateElement).content.querySelector(".bomb");return X(e.cloneNode(!0),SVGPathElement)};{const e=At({x:1,y:1},{x:3,y:4},1.5),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.style.fill="none",n.style.stroke="white",n.style.strokeWidth="0.02px",n.style.strokeLinecap="round",n.style.transform="translate(0.5px,0.5px)",n.setAttribute("d",e),o.appendChild(n);const r=t();r.style.fill="black";const s=document.createElementNS("http://www.w3.org/2000/svg","g");s.appendChild(r),o.appendChild(s),s.style.offsetPath=`path('${e}')`,s.style.offsetRotate="0deg",s.animate({offsetDistance:["0%","100%"]},{duration:3e3,iterations:1/0,easing:"ease-in-out"}),console.log({path:e,pathElement:n,bombElement:r,bombHolder:s})}{const e=Ft({x:1,y:1},{x:3,y:4},Nt(1,Math.PI,4*Math.PI)),n=U(e,{numberOfSegments:20}),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.style.fill="none",r.style.stroke="blue",r.style.strokeWidth="0.02px",r.style.strokeLinecap="round",r.style.transform="translate(0.5px,0.5px)",r.setAttribute("d",n),o.appendChild(r);const s=t();s.style.fill="lightblue";const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.appendChild(s),o.appendChild(i),i.style.offsetPath=`path('${n}')`,i.style.offsetRotate="0deg",i.animate([{offset:0,offsetDistance:"0%",easing:"ease-in-out"},{offset:.95,offsetDistance:"100%",easing:"ease-in-out"},{offset:1,offsetDistance:"100%",easing:"ease-in-out"}],{duration:3e3,iterations:1/0,easing:"ease-in-out",iterationStart:.5}),console.log(n,r)}}
