(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();var i={};Object.defineProperty(i,"__esModule",{value:!0});i.permutations=i.polarToRectangular=i.makeBoundedLinear=V=i.makeLinear=i.sum=i.countMap=z=i.initializedArray=i.count=i.zip=i.FIGURE_SPACE=i.NON_BREAKING_SPACE=i.dateIsValid=i.MIN_DATE=i.MAX_DATE=i.makePromise=i.filterMap=D=i.pick=i.pickAny=i.csvStringToArray=i.parseTimeT=i.parseIntX=i.parseFloatX=i.getAttribute=i.followPath=i.parseXml=i.testXml=W=i.sleep=Q=i.assertClass=void 0;function ie(n,e,t="Assertion Failed."){const r=o=>{throw new Error(`${t}  Expected type:  ${e.name}.  Found type:  ${o}.`)};if(n===null)r("null");else if(typeof n!="object")r(typeof n);else if(!(n instanceof e))r(n.constructor.name);else return n;throw new Error("wtf")}var Q=i.assertClass=ie;function ae(n){return new Promise(e=>setTimeout(e,n))}var W=i.sleep=ae;function U(n){const t=new DOMParser().parseFromString(n,"application/xml");for(const r of Array.from(t.querySelectorAll("parsererror")))if(r instanceof HTMLElement)return{error:r};return{parsed:t}}i.testXml=U;function ce(n){if(n!==void 0)return U(n)?.parsed?.documentElement}i.parseXml=ce;function _(n,...e){for(const t of e){if(n===void 0)return;if(typeof t=="number")n=n.children[t];else{const r=n.getElementsByTagName(t);if(r.length!=1)return;n=r[0]}}return n}i.followPath=_;function le(n,e,...t){if(e=_(e,...t),e!==void 0&&e.hasAttribute(n))return e.getAttribute(n)??void 0}i.getAttribute=le;function ee(n){if(n==null)return;const e=parseFloat(n);if(isFinite(e))return e}i.parseFloatX=ee;function te(n){const e=ee(n);if(e!==void 0)return e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER||e!=Math.floor(e)?void 0:e}i.parseIntX=te;function ue(n){if(typeof n=="string"&&(n=te(n)),n!=null&&!(n<=0))return new Date(n*1e3)}i.parseTimeT=ue;const fe=n=>{const e=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,t=[[]];let r;for(;r=e.exec(n);)r[1].length&&r[1]!==","&&t.push([]),t[t.length-1].push(r[2]!==void 0?r[2].replace(/""/g,'"'):r[3]);return t};i.csvStringToArray=fe;function de(n){const e=n.values().next();if(!e.done)return e.value}i.pickAny=de;function he(n){return n[Math.random()*n.length|0]}var D=i.pick=he;function me(n,e){const t=[];return n.forEach((r,o)=>{const s=e(r,o);s!==void 0&&t.push(s)}),t}i.filterMap=me;function pe(){let n,e;return{promise:new Promise((r,o)=>{n=r,e=o}),resolve:n,reject:e}}i.makePromise=pe;i.MAX_DATE=new Date(864e13);i.MIN_DATE=new Date(-864e13);function we(n){return isFinite(n.getTime())}i.dateIsValid=we;i.NON_BREAKING_SPACE=" ";i.FIGURE_SPACE=" ";function*ge(...n){const e=n.map(t=>t[Symbol.iterator]());for(;;){const t=e.map(r=>r.next());if(t.some(({done:r})=>r))break;yield t.map(({value:r})=>r)}}i.zip=ge;function*Ee(n=0,e=1/0,t=1){for(let r=n;r<e;r+=t)yield r}i.count=Ee;function ne(n,e){const t=[];for(let r=0;r<n;r++)t.push(e(r));return t}var z=i.initializedArray=ne;i.countMap=ne;function ve(n){return n.reduce((e,t)=>e+t,0)}i.sum=ve;function Se(n,e,t,r){const o=(r-e)/(t-n);return function(s){return(s-n)*o+e}}var V=i.makeLinear=Se;function Me(n,e,t,r){t<n&&([n,e,t,r]=[t,r,n,e]);const o=(r-e)/(t-n);return function(s){return s<=n?e:s>=t?r:(s-n)*o+e}}i.makeBoundedLinear=Me;function ye(n,e){return{x:Math.sin(e)*n,y:Math.cos(e)*n}}i.polarToRectangular=ye;function*re(n,e=[]){if(n.length==0)yield e;else for(let t=0;t<n.length;t++){const r=n[t],o=[...e,r],s=[...n.slice(0,t),...n.slice(t+1)];yield*re(s,o)}}i.permutations=re;var v={};Object.defineProperty(v,"__esModule",{value:!0});v.download=v.createElementFromHTML=v.getHashInfo=v.getAudioBalanceControl=v.getBlobFromCanvas=v.loadDateTimeLocal=B=v.getById=void 0;const oe=i;function be(n,e){const t=document.getElementById(n);if(!t)throw new Error("Could not find element with id "+n+".  Expected type:  "+e.name);if(t instanceof e)return t;throw new Error("Element with id "+n+" has type "+t.constructor.name+".  Expected type:  "+e.name)}var B=v.getById=be;function Ie(n,e,t="milliseconds"){let r;switch(t){case"minutes":{r=e.getSeconds()*1e3+e.getMilliseconds();break}case"seconds":{r=e.getMilliseconds();break}case"milliseconds":{r=0;break}default:throw new Error("wtf")}n.valueAsNumber=+e-e.getTimezoneOffset()*6e4-r}v.loadDateTimeLocal=Ie;function Ce(n){const{reject:e,resolve:t,promise:r}=(0,oe.makePromise)();return n.toBlob(o=>{o?t(o):e(new Error("blob is null!"))}),r}v.getBlobFromCanvas=Ce;function ke(n){const e=new AudioContext,t=e.createMediaElementSource(n),r=new StereoPannerNode(e,{pan:0});return t.connect(r).connect(e.destination),o=>{r.pan.value=o}}v.getAudioBalanceControl=ke;function Ae(){const n=new Map;return/^#?(.*)$/.exec(location.hash.replace("+","%20"))[1].split("&").forEach(r=>{const o=r.split("=",2);if(o.length==2){const s=decodeURIComponent(o[0]),a=decodeURIComponent(o[1]);n.set(s,a)}}),n}v.getHashInfo=Ae;function Te(n,e){var t=document.createElement("div");return t.innerHTML=n.trim(),(0,oe.assertClass)(t.firstChild,e,"createElementFromHTML:")}v.createElementFromHTML=Te;function Pe(n,e){var t=document.createElement("a");if(t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",n),document.createEvent){var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0),t.dispatchEvent(r)}else t.click()}v.download=Pe;class q{#e=new Set;get contents(){return this.#e}static#n=0;#t=q.#n++;debugInitialGroup;debugInfo(){return{row:this.debugInitialGroup.row,column:this.debugInitialGroup.column,contents:this.valid?this.#e.size:"invalid",id:this.#t}}color;constructor(e){this.color=e.color,this.debugInitialGroup=e,this.#e.add(e)}consume(e){const t=this.#e,r=e.#e;return r.forEach(o=>t.add(o)),e.#e=void 0,r}get valid(){return!!this.#e?.has(this.debugInitialGroup)}}class K{constructor(e,t,r){this.row=e,this.column=t,this.piece=r,this.#e=new q(this)}#e;get color(){return this.piece.color}static createAll(e){return e.allPieces.map((t,r)=>t.map((o,s)=>new K(r,s,o)))}tryCombine(e){if(this.#e!=e.#e&&this.color==e.color&&(this.#e.consume(e.#e).forEach(r=>r.#e=this.#e),!this.#e.valid))throw new Error("wtf")}static combineAll(e){e.forEach((t,r)=>{t.forEach((o,s)=>{if(r){const a=r-1,l=e[a][s];o.tryCombine(l)}if(s){const a=s-1,l=t[a];o.tryCombine(l)}})})}static findBigGroups(e){const t=new Map;e.forEach(o=>o.forEach(s=>{const a=s.#e,l=t.get(a)??0;t.set(a,l+1)}));const r=[];for(const[o,s]of t)s>=3&&r.push(o);return r}static findActionable(e){const t=this.createAll(e);return this.combineAll(t),this.findBigGroups(t)}}function j(n){return K.findActionable(n)}function O(n,e){const t=n%e;return t<0?t+Math.abs(e):t}function Re(n,e){if((e|0)!=e)throw new Error(`invalid input: ${e}`);return e=O(e,n.length),e==0?n:[...n.slice(e),...n.slice(0,e)]}const J=["red","green","blue","yellow","orange","violet"];class c{constructor(e){this.allPieces=e}static SIZE=6;getColumn(e){return this.allPieces.map(t=>t[e])}static randomPiece(){return{weight:1,color:D(J),bomb:!1}}static createRandom(){const e=z(c.SIZE,()=>z(c.SIZE,this.randomPiece));return j(new c(e)).forEach(r=>{r.contents.forEach(({row:o,column:s})=>{const a=new Set;[[0,1],[0,-1],[1,0],[-1,0]].forEach(([l,w])=>{const g=e[o+l];if(g){const b=g[s+w];b&&a.add(b.color)}}),e[o][s]={color:D(J.filter(l=>!a.has(l))),weight:1,bomb:!1}})}),new this(e)}rotateLeft(e,t){const r=this.allPieces[e],o=Re(r,t);return r==o?this:new c(this.allPieces.map(s=>s==r?o:s))}rotateUp(e,t){const r=this.allPieces.length;return t=O(t,r),t==0?this:new c(this.allPieces.map((o,s)=>{const a=[...o];return a[e]=this.allPieces[(s+t)%r][e],a}))}compileAnimation(e){const t=z(c.SIZE,()=>new Set);e.forEach(s=>{s.contents.forEach(({row:a,column:l})=>{const w=t[l];if(w.has(a))throw new Error("wtf");w.add(a)})});const r=t.map(s=>({addFromBottom:[],addFromTop:[],indicesToRemove:s})),o=z(c.SIZE,()=>new Array(c.SIZE));return r.forEach((s,a)=>{const l=t[a],w=[];for(let g=0;g<c.SIZE;g++)l.has(g)||w.push(this.allPieces[g][a]);for(;w.length<c.SIZE;){const g=c.randomPiece();s.addFromTop.push(g),w.unshift(g)}w.forEach((g,b)=>o[b][a]=g)}),{columns:r,final:new c(o)}}}{let n="☆";setInterval(()=>{document.title=`${n} Classic Chuzzle`,n=n=="☆"?"★":"☆"},1e3)}{const[n,e]=B("background",SVGGElement).querySelectorAll("circle");n.animate([{transform:"rotate(720deg)"},{transform:"rotate(0deg)"}],{duration:67973,easing:"ease",iterations:1/0}),e.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:19701,easing:"cubic-bezier(0.42, 0, 0.32, 1.83)",iterations:1/0})}class p{constructor(e){this.piece=e,e[p.#a]=this;const t=Q(p.#n.cloneNode(!0),SVGGElement);this.element=t,this.decorationElement=t.querySelector("text"),t.setAttribute("fill",e.color),p.#e.appendChild(t)}static flashGroupDecorations(e){e.forEach(t=>{const r=[...t.contents].map(w=>p.for(w.piece)),o=1,a=[{opacity:Math.random()*.2+.05},{opacity:o}],l={direction:D(["alternate","alternate-reverse","normal","reverse"]),duration:550+Math.random()*150,easing:D(["linear","ease-in","ease-out","ease-in-out"]),iterationStart:Math.random(),iterations:1/0};r.forEach(w=>{w.decorationElement.animate(a,l)})})}static removeAll(){this.#e.innerHTML=""}static#e=B("board",SVGElement);static#n=B("piece",HTMLTemplateElement).content.querySelector("g");element;decorationElement;static#t=CSS.px(Math.E);static#r=CSS.px(Math.PI);static#s=new CSSTransformValue([new CSSTranslate(this.#t,this.#r)]);#o=0;get row(){return this.#o}#i=0;get column(){return this.#i}setPosition(e,t){p.#t.value=this.#i=t,p.#r.value=this.#o=e,this.element.attributeStyleMap.set("transform",p.#s)}animateMove(e,t,r){const o=this.#i,s=this.#o;this.setPosition(e,t);const a=this.element;return a.parentElement?.appendChild(a),a.animate([{transform:`translate(${o}px, ${s}px)`},{transform:`translate(${t}px, ${e}px)`}],r).finished}static#a=Symbol("GuiPiece");static for(e){const t=e[this.#a];if(!(t instanceof p))throw console.error(t),new Error("wtf");return t}static showGroups(e){e.forEach(({group:t,decorationColor:r,decorationText:o})=>{t.contents.forEach(s=>{const a=p.for(s.piece).decorationElement;a.textContent=o,a.style.fill=r})})}}class I{static#e=B("newScore",HTMLDivElement);static#n=B("chainBonus",HTMLDivElement);#t=[];#r=c.createRandom();get currentBoard(){return this.#r}set currentBoard(e){this.#r=e,this.draw()}static#s=new Map([["orange",["cyan","brown","white","darkviolet","lightyellow","darkgreen","darkolivegreen","darkred"]],["yellow",["brown","darkviolet","lightcoral","lightsalmon","lightseagreen","darkblue","darkcyan","darkgoldenrod","darkgreen","darkkhaki","darkolivegreen","darkorange","darkred","darksalmon","darkseagreen"]],["violet",["cyan","brown","white","darkviolet","lightgreen","darkblue"]],["blue",["cyan","white","lightcoral","lightgreen","lightgray","lightsalmon","lightseagreen","lightseagreen","lightskyblue","lightslategray","darkorange","darkseagreen","darkturquoise"]],["red",["cyan","white","lightcoral","lightgreen","lightsalmon","darkkhaki","darkseagreen","chartreuse"]],["green",["cyan","white","lightcoral","lightcyan","lightgreen","lightyellow","darkred","darkseagreen","chartreuse"]]]);static#o=["ʻ","☆","𝛿","∞","•","⭑","†","‡","؟","༗","ၯ","◦","§","_","ɝ","Ԕ","⟳","⚐","🜚","愛","❝","ℵ","を","ᇸ","ڰ","ॾ","ৼ","ན","ᛧ","ß","⧕","↯","➷","⅋","☙","„","⌥","⧷","⁎","╕","₰","…","⑈","۽","ₜ","ಠ","෴","ጃ","ᔱ","ᔰ","Ѧ","ᑥ","𝄢","ƈ","Ɣ","ƕ","Ɋ","ɕ","ɮ","ʆ","Ξ","Ж","Ѭ","Զ","ܔ","ঔ","ਐ","ઝ","ଈ","ஜ","ధ","ൠ","ඊ","ጯ","ᡀ","‰","₻","↉","↜","↸","⋨","⌤","⎌","⍾","☏","✗","➘","〷","ご","ᇌ","㊤","﹆","🜇","🝤"];static assignGroupDecorations(e){if(e.length==0)return[];{const t=[...this.#o];return e.map(r=>{const o=D(this.#s.get(r.color)),s=Math.floor(Math.random()*t.length),a=t[s];return t.splice(s,1),{group:r,decorationColor:o,decorationText:a}})}}removeGroups(){this.#t.forEach(e=>e.forEach(t=>t.decorationElement.textContent=""))}draw(){this.resetAll(),this.#t=this.#r.allPieces.map((e,t)=>e.map((r,o)=>{const s=new p(r);return s.setPosition(t,o),s}))}resetAll(){p.removeAll(),this.#t=[]}static animationOptions(e){return{duration:Math.abs(e)*2e3/c.SIZE}}constructor(){this.draw();const e=B("main",SVGSVGElement),t=B("board",SVGElement);function r(h){const u=e.getBoundingClientRect(),L=V(u.top,0,u.bottom,c.SIZE),m=V(u.left,0,u.right,c.SIZE);return{row:L(h.clientY),column:m(h.clientX)}}let o="none",s=-1,a=-1,l=-1;t.addEventListener("pointerdown",h=>{if(o=="none"){h.stopPropagation(),o="started",t.setPointerCapture(h.pointerId);const u=r(h);s=u.row,a=u.column,t.style.cursor="move"}});const w=h=>{switch(o){case"none":case"started":case"animation":return;case"horizontal":{const{column:u}=r(h);return a-u}case"vertical":{const{row:u}=r(h);return s-u}}throw new Error("wtf")},g=h=>{if(o=="none")return 0;{const u=r(h);if(o=="horizontal")return O(Math.round(a-u.column),c.SIZE);if(o=="vertical")return O(Math.round(s-u.row),c.SIZE);if(o=="started")return 0}throw new Error("wtf")};let b,G=0;t.addEventListener("pointermove",h=>{if(o=="none"||o=="animation")return;h.stopPropagation();const u=r(h);if(o=="started"){const m=Math.abs(u.row-s),R=Math.abs(u.column-a);if(Math.max(m,R)<.05)return;if(m>R)o="vertical",t.style.cursor="ns-resize",l=Math.floor(a);else if(R>m)o="horizontal",t.style.cursor="ew-resize",l=Math.floor(s);else return;if(l=Math.max(0,Math.min(c.SIZE,l)),b)throw new Error("wtf");const x=o=="vertical"?"rotateUp":"rotateLeft";b=z(c.SIZE,Z=>{const N=this.#r[x](l,Z),H=I.assignGroupDecorations(j(N));return{board:N,decoratedGroups:H}}),G=0}const L=m=>O(m+.5,c.SIZE)-.5;if(o=="horizontal"){const m=a-u.column;this.#t[l].forEach((x,Z)=>{x.setPosition(l,L(Z-m))})}else if(o=="vertical"){const m=s-u.row;this.#t.forEach((R,x)=>{R[l].setPosition(L(x-m),l)})}if(b){const m=g(h);m!=G&&(G=m,this.removeGroups(),p.showGroups(b[G].decoratedGroups))}}),t.addEventListener("lostpointercapture",async h=>{if(o=="none"||o=="started"){if(o="none",t.style.cursor="",b)throw new Error("wtf");return}t.style.cursor="none";const u=[];if(!b)throw new Error("wtf");const L=g(h),m=b[L],{newBoard:R,newOffset:x}=m.decoratedGroups.length==0?{newBoard:this.currentBoard,newOffset:0}:{newBoard:m.board,newOffset:L},Z=O(w(h)-x+c.SIZE/2,c.SIZE)-c.SIZE/2,N=I.animationOptions(Z),H=C=>{const S=[C],A=[0],f=O(Math.round(C+Z),c.SIZE);if(f>5.1)throw new Error("wtf");const M=(y,E)=>{S.push(y,E);const d=Math.abs(C-y),T=Math.abs(E-f),k=d+T,P=d/k;A.push(P,P)};return Math.sign(Z)==-1?f>C&&M(-.5,c.SIZE-.5):f<C&&M(c.SIZE-.5,-.5),S.push(f),A.push(1),{position:S,offset:A,finalPosition:f}};o=="horizontal"?this.#t[l].forEach(S=>{const{position:A,offset:f,finalPosition:M}=H(S.column),y=A.map(E=>`translate(${E}px, ${l}px)`);u.push(S.element.animate({transform:y,offset:f},N).finished),S.setPosition(l,M)}):o=="vertical"&&this.#t.forEach(C=>{const S=C[l],{position:A,offset:f,finalPosition:M}=H(S.row),y=A.map(E=>`translate(${l}px, ${E}px)`);u.push(S.element.animate({transform:y,offset:f},N).finished),S.setPosition(M,l)}),o="animation",u.length>0&&(await Promise.all(u),u.length=0,this.currentBoard=R),b=void 0;let{decoratedGroups:F}=m,$=1;for(;F.length>0;){$<2?I.#n.innerHTML="":I.#n.innerText=`Chain Bonus: ⨉ ${$}`,$++,I.#e.innerHTML="",F.forEach(({group:f,decorationText:M,decorationColor:y},E)=>{E>0&&I.#e.append(" + ");const d=document.createElement("span");d.innerText=`${M} ${f.contents.size}`,d.style.color=y,d.style.borderColor=d.style.backgroundColor=f.color,d.classList.add("individualScore"),I.#e.appendChild(d)}),p.showGroups(F);const C=F.map(f=>f.group);p.flashGroupDecorations(C),await W(2e3);const{columns:S,final:A}=this.currentBoard.compileAnimation(C);S.forEach((f,M)=>{for(const y of f.indicesToRemove){const E=this.#t[y][M];let d,T;d=Math.random()*(c.SIZE/2-1),T=Math.random()*(c.SIZE/2-1);{const k=Math.random()*3;k>1&&(d-=c.SIZE/2),k<2&&(T-=c.SIZE/2)}{const k=P=>Math.random()>(P+1)/(c.SIZE+1);k(y)&&(d=c.SIZE-d-1),k(M)&&(T=c.SIZE-T-1)}u.push(E.animateMove(d,T,{duration:1e3,easing:"ease-in"}))}}),await Promise.all(u),u.length=0,S.forEach(({addFromTop:f,addFromBottom:M,indicesToRemove:y},E)=>{if(M.length>0)throw new Error("Not implemented yet.");if(M.length+f.length!=y.size)throw new Error("wtf");let d=f.length;const T=I.animationOptions(d);f.forEach((k,P)=>{const X=new p(k),Y=-(P+1),se=Y+d;X.setPosition(Y,E),u.push(X.animateMove(se,E,T))}),this.currentBoard.getColumn(E).forEach((k,P)=>{y.has(P)?d--:d&&p.for(k).animateMove(P+d,E,T)})}),await Promise.all(u),u.length=0,this.currentBoard=A,F=I.assignGroupDecorations(j(A))}I.#e.innerHTML="",I.#n.innerHTML="",t.style.cursor="",o="none"})}}new I;
