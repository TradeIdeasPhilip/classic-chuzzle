(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();var m={},c={};Object.defineProperty(c,"__esModule",{value:!0});c.permutations=c.polarToRectangular=c.makeBoundedLinear=M=c.makeLinear=c.sum=c.countMap=y=c.initializedArray=c.count=c.zip=c.FIGURE_SPACE=c.NON_BREAKING_SPACE=c.dateIsValid=c.MIN_DATE=c.MAX_DATE=c.makePromise=c.filterMap=b=c.pick=c.pickAny=c.csvStringToArray=c.parseTimeT=c.parseIntX=c.parseFloatX=c.getAttribute=c.followPath=c.parseXml=c.testXml=P=c.sleep=c.assertClass=void 0;function Q(n,t,e="Assertion Failed."){const o=r=>{throw new Error(`${e}  Expected type:  ${t.name}.  Found type:  ${r}.`)};if(n===null)o("null");else if(typeof n!="object")o(typeof n);else if(!(n instanceof t))o(n.constructor.name);else return n;throw new Error("wtf")}c.assertClass=Q;function W(n){return new Promise(t=>setTimeout(t,n))}var P=c.sleep=W;function L(n){const e=new DOMParser().parseFromString(n,"application/xml");for(const o of Array.from(e.querySelectorAll("parsererror")))if(o instanceof HTMLElement)return{error:o};return{parsed:e}}c.testXml=L;function Y(n){if(n!==void 0)return L(n)?.parsed?.documentElement}c.parseXml=Y;function Z(n,...t){for(const e of t){if(n===void 0)return;if(typeof e=="number")n=n.children[e];else{const o=n.getElementsByTagName(e);if(o.length!=1)return;n=o[0]}}return n}c.followPath=Z;function J(n,t,...e){if(t=Z(t,...e),t!==void 0&&t.hasAttribute(n))return t.getAttribute(n)??void 0}c.getAttribute=J;function D(n){if(n==null)return;const t=parseFloat(n);if(isFinite(t))return t}c.parseFloatX=D;function O(n){const t=D(n);if(t!==void 0)return t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER||t!=Math.floor(t)?void 0:t}c.parseIntX=O;function tt(n){if(typeof n=="string"&&(n=O(n)),n!=null&&!(n<=0))return new Date(n*1e3)}c.parseTimeT=tt;const et=n=>{const t=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,e=[[]];let o;for(;o=t.exec(n);)o[1].length&&o[1]!==","&&e.push([]),e[e.length-1].push(o[2]!==void 0?o[2].replace(/""/g,'"'):o[3]);return e};c.csvStringToArray=et;function nt(n){const t=n.values().next();if(!t.done)return t.value}c.pickAny=nt;function ot(n){return n[Math.random()*n.length|0]}var b=c.pick=ot;function rt(n,t){const e=[];return n.forEach((o,r)=>{const s=t(o,r);s!==void 0&&e.push(s)}),e}c.filterMap=rt;function st(){let n,t;return{promise:new Promise((o,r)=>{n=o,t=r}),resolve:n,reject:t}}c.makePromise=st;c.MAX_DATE=new Date(864e13);c.MIN_DATE=new Date(-864e13);function at(n){return isFinite(n.getTime())}c.dateIsValid=at;c.NON_BREAKING_SPACE=" ";c.FIGURE_SPACE=" ";function*it(...n){const t=n.map(e=>e[Symbol.iterator]());for(;;){const e=t.map(o=>o.next());if(e.some(({done:o})=>o))break;yield e.map(({value:o})=>o)}}c.zip=it;function*lt(n=0,t=1/0,e=1){for(let o=n;o<t;o+=e)yield o}c.count=lt;function B(n,t){const e=[];for(let o=0;o<n;o++)e.push(t(o));return e}var y=c.initializedArray=B;c.countMap=B;function ct(n){return n.reduce((t,e)=>t+e,0)}c.sum=ct;function ut(n,t,e,o){const r=(o-t)/(e-n);return function(s){return(s-n)*r+t}}var M=c.makeLinear=ut;function dt(n,t,e,o){e<n&&([n,t,e,o]=[e,o,n,t]);const r=(o-t)/(e-n);return function(s){return s<=n?t:s>=e?o:(s-n)*r+t}}c.makeBoundedLinear=dt;function ht(n,t){return{x:Math.sin(t)*n,y:Math.cos(t)*n}}c.polarToRectangular=ht;function*V(n,t=[]){if(n.length==0)yield t;else for(let e=0;e<n.length;e++){const o=n[e],r=[...t,o],s=[...n.slice(0,e),...n.slice(e+1)];yield*V(s,r)}}c.permutations=V;Object.defineProperty(m,"__esModule",{value:!0});m.download=m.createElementFromHTML=m.getHashInfo=m.getAudioBalanceControl=m.getBlobFromCanvas=m.loadDateTimeLocal=g=m.getById=void 0;const H=c;function ft(n,t){const e=document.getElementById(n);if(!e)throw new Error("Could not find element with id "+n+".  Expected type:  "+t.name);if(e instanceof t)return e;throw new Error("Element with id "+n+" has type "+e.constructor.name+".  Expected type:  "+t.name)}var g=m.getById=ft;function mt(n,t,e="milliseconds"){let o;switch(e){case"minutes":{o=t.getSeconds()*1e3+t.getMilliseconds();break}case"seconds":{o=t.getMilliseconds();break}case"milliseconds":{o=0;break}default:throw new Error("wtf")}n.valueAsNumber=+t-t.getTimezoneOffset()*6e4-o}m.loadDateTimeLocal=mt;function pt(n){const{reject:t,resolve:e,promise:o}=(0,H.makePromise)();return n.toBlob(r=>{r?e(r):t(new Error("blob is null!"))}),o}m.getBlobFromCanvas=pt;function gt(n){const t=new AudioContext,e=t.createMediaElementSource(n),o=new StereoPannerNode(t,{pan:0});return e.connect(o).connect(t.destination),r=>{o.pan.value=r}}m.getAudioBalanceControl=gt;function yt(){const n=new Map;return/^#?(.*)$/.exec(location.hash.replace("+","%20"))[1].split("&").forEach(o=>{const r=o.split("=",2);if(r.length==2){const s=decodeURIComponent(r[0]),a=decodeURIComponent(r[1]);n.set(s,a)}}),n}m.getHashInfo=yt;function wt(n,t){var e=document.createElement("div");return e.innerHTML=n.trim(),(0,H.assertClass)(e.firstChild,t,"createElementFromHTML:")}m.createElementFromHTML=wt;function Et(n,t){var e=document.createElement("a");if(e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download",n),document.createEvent){var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!0),e.dispatchEvent(o)}else e.click()}m.download=Et;class bt{#t=new Set;get contents(){return[...this.#t].map(t=>t.piece)}get size(){return this.#t.size}debugInitialCell;color;constructor(t){this.color=t.color,this.debugInitialCell=t,this.#t.add(t)}consume(t){const e=this.#t,o=t.#t;return o.forEach(r=>e.add(r)),t.#t=void 0,o}get valid(){return!!this.#t?.has(this.debugInitialCell)}}class F{constructor(t){this.piece=t,this.#t=new bt(this)}#t;get color(){return this.piece.color}static createAll(t){return t.map(e=>e.map(o=>new F(o)))}tryCombine(t){if(this.#t!=t.#t&&this.color==t.color&&(this.#t.consume(t.#t).forEach(o=>o.#t=this.#t),!this.#t.valid))throw new Error("wtf")}static combineAll(t){t.forEach((e,o)=>{e.forEach((r,s)=>{if(o){const a=o-1,i=t[a][s];r.tryCombine(i)}if(s){const a=s-1,i=e[a];r.tryCombine(i)}})})}static findBigGroups(t){const e=new Map;t.forEach(r=>r.forEach(s=>{const a=s.#t,i=e.get(a)??0;e.set(a,i+1)}));const o=[];for(const[r,s]of e)s>=3&&o.push(r);return o}static findActionable(t){const e=this.createAll(t);return this.combineAll(e),this.findBigGroups(e)}}function C(n){return F.findActionable(n).map(t=>t.contents)}function x(n,t){const e=n%t;return e<0?e+Math.abs(t):e}function Mt(n,t){if((t|0)!=t)throw new Error(`invalid input: ${t}`);return t=x(t,n.length),t==0?n:[...n.slice(t),...n.slice(0,t)]}function X(n,t,e="Assertion Failed."){const o=r=>{throw new Error(`${e}  Expected type:  ${t.name}.  Found type:  ${r}.`)};if(n===null)o("null");else if(typeof n!="object")o(typeof n);else if(!(n instanceof t))o(n.constructor.name);else return n;throw new Error("wtf")}function j(n,t){return{x:Math.cos(t)*n,y:Math.sin(t)*n}}const k=n=>x(Math.round(n),h.SIZE);function vt(n,t,e){const o=n[t],r=Mt(o,e);return o==r?n:n.map(s=>s==o?r:s)}function It(n,t,e){const o=n.length;return e=x(e,o),e==0?n:n.map((r,s)=>{const a=[...r];return a[t]=n[(s+e)%o][t],a})}const E=["red","green","blue","yellow","orange","violet"];class S{constructor(t,e,o=S.randomColor()){this.rowIndex=t,this.columnIndex=e,this.color=o}weight=1;bomb=!1;static randomColor(){return b(E)}}class h{constructor(t){this.animator=t,this.#t=this.createRandom(),this.#t.forEach(e=>e.forEach(o=>this.animator.initializePiece(o)))}static SIZE=6;#t;getColumn(t){return this.#t.map(e=>e[t])}createRandom(){const t=y(h.SIZE,o=>y(h.SIZE,r=>new S(o,r)));return C(t).forEach(o=>{o.forEach(({rowIndex:r,columnIndex:s})=>{const a=new Set;[[0,1],[0,-1],[1,0],[-1,0]].forEach(([i,l])=>{const u=t[r+i];if(u){const d=u[s+l];d&&a.add(d.color)}}),t[r][s]=new S(r,s,b(E.filter(i=>!a.has(i))))})}),t}async updateLoop(t,e){for(let o=1;t.length>0;o++){const r=new Set,s=[];t.forEach(a=>{if(a.length==5){const i=b(a);i.bomb=!0,r.add(i),this.animator.updateBomb(i),s.push(i)}}),await e.addToScore(o),s.forEach(a=>this.animator.cancelGroup(a)),await this.removePieces(t.flatMap(a=>a.filter(i=>!r.has(i)))),t=C(this.#t),e=this.animator.assignGroupDecorations(t),e.highlightGroups()}}setAllPieces(t){this.#t=t,t.forEach((e,o)=>{e.forEach((r,s)=>{r.columnIndex=s,r.rowIndex=o})})}startHorizontalMove(t){const e=y(h.SIZE,s=>{const a=vt(this.#t,t,-s),i=C(a);return{actions:this.animator.assignGroupDecorations(i),groups:i,pieces:a}}),o=s=>{const a=this.#t[t];this.animator.drawPreview("horizontal",a,s),e[k(s)].actions.highlightGroups()};return{preview:o,release:async s=>{o(s);const a=k(s),l=e[a].groups.length==0?0:a,u=e[l];this.setAllPieces(u.pieces);const d=this.#t[t];await this.animator.rotateTo("horizontal",d),await this.updateLoop(u.groups,u.actions)}}}startVerticalMove(t){const e=y(h.SIZE,s=>{const a=It(this.#t,t,-s),i=C(a);return{actions:this.animator.assignGroupDecorations(i),groups:i,pieces:a}}),o=s=>{const a=this.getColumn(t);this.animator.drawPreview("vertical",a,s),e[k(s)].actions.highlightGroups()};return{preview:o,release:async s=>{o(s);const a=k(s),l=e[a].groups.length==0?0:a,u=e[l];this.setAllPieces(u.pieces);const d=this.getColumn(t);await this.animator.rotateTo("vertical",d),await this.updateLoop(u.groups,u.actions)}}}async removePieces(t){const e=y(h.SIZE,()=>new Set);{const s=t.map(({rowIndex:a,columnIndex:i})=>{const l=e[i];if(l.has(a))throw new Error("wtf");return l.add(a),this.animator.destroyPiece(this.#t[a][i])});await Promise.all(s)}const o=y(h.SIZE,()=>new Array(h.SIZE)),r=[];e.forEach((s,a)=>{const i=[];for(let l=0;l<h.SIZE;l++)s.has(l)||i.push(this.#t[l][a]);for(let l=0;i.length<h.SIZE;l++){const u=-1-l,d=new S(u,a);this.animator.initializePiece(d),i.unshift(d)}i.forEach((l,u)=>{o[u][a]=l,l.columnIndex=a,l.rowIndex=u,r.push(l)})}),await Promise.all(r.map(s=>this.animator.slideTo(s))),this.setAllPieces(o)}}const T=g("newScore",HTMLDivElement),G=g("chainBonus",HTMLDivElement),_=new Map([["orange",["cyan","brown","white","darkviolet","lightyellow","darkgreen","darkolivegreen","darkred"]],["yellow",["brown","darkviolet","lightcoral","lightsalmon","lightseagreen","darkblue","darkcyan","darkgoldenrod","darkgreen","darkkhaki","darkolivegreen","darkorange","darkred","darksalmon","darkseagreen"]],["violet",["cyan","brown","white","darkviolet","lightgreen","darkblue"]],["blue",["cyan","white","lightcoral","lightgreen","lightgray","lightsalmon","lightseagreen","lightseagreen","lightskyblue","lightslategray","darkorange","darkseagreen","darkturquoise"]],["red",["cyan","white","lightcoral","lightgreen","lightsalmon","darkkhaki","darkseagreen","chartreuse"]],["green",["cyan","white","lightcoral","lightcyan","lightgreen","lightyellow","darkred","darkseagreen","chartreuse"]]]),St=["ʻ","☆","𝛿","∞","•","⭑","†","‡","؟","༗","ၯ","◦","§","_","ɝ","Ԕ","⟳","⚐","🜚","愛","❝","ℵ","を","ᇸ","ڰ","ॾ","ৼ","ན","ᛧ","ß","⧕","↯","➷","⅋","☙","„","⌥","⧷","⁎","╕","₰","…","⑈","۽","ₜ","ಠ","෴","ጃ","ᔱ","ᔰ","Ѧ","ᑥ","𝄢","ƈ","Ɣ","ƕ","Ɋ","ɕ","ɮ","ʆ","Ξ","Ж","Ѭ","Զ","ঔ","ਐ","ઝ","ଈ","ஜ","ధ","ൠ","ඊ","ጯ","ᡀ","‰","₻","↉","↜","↸","⋨","⌤","⎌","⍾","☏","✗","➘","〷","ご","ᇌ","㊤","﹆","🜇","🝤"];let A=1;function N(n){return{duration:Math.abs(n)*2e3/h.SIZE*A}}const q=g("board",SVGElement);function R(){q.querySelectorAll("text.crystal-decoration,text.crystal-decoration-background").forEach(n=>n.textContent="")}class v{static#t=g("piece",HTMLTemplateElement).content.querySelector("g");element;decorationElement;decorationBackgroundElement;bombElement;get bombVisible(){return this.bombElement.style.display==""}set bombVisible(t){this.bombElement.style.display=t?"":"none"}static#o=CSS.px(Math.E);static#r=CSS.px(Math.PI);static#s=new CSSTransformValue([new CSSTranslate(this.#o,this.#r)]);updateFinalPosition(t){this.#n=t.columnIndex,this.#e=t.rowIndex,v.#o.value=t.columnIndex,v.#r.value=t.rowIndex,this.element.attributeStyleMap.set("transform",v.#s)}async slideDirectlyTo(t,e){const o=this.#n,r=this.#e;this.updateFinalPosition(t);const s=this.#n,a=this.#e;if(!e){const u=Math.hypot(a-r,s-o);e=N(u)}const i=this.element;i.parentElement?.appendChild(i),await i.animate([{transform:`translate(${o}px, ${r}px)`},{transform:`translate(${t.columnIndex}px, ${t.rowIndex}px)`}],e).finished}async rotateTo(t,e){const o=e=="horizontal",r=(()=>{const l=o?t.columnIndex-this.#n:t.rowIndex-this.#e,u=x(l+h.SIZE/2,h.SIZE)-h.SIZE/2;return N(Math.abs(u))})(),{position:s,offset:a}=o?z(this.#n,t.columnIndex):z(this.#e,t.rowIndex),i=s.map(l=>o?`translate(${l}px, ${t.rowIndex}px)`:`translate(${t.columnIndex}px, ${l}px)`);this.updateFinalPosition(t),await this.element.animate({transform:i,offset:a},r).finished}#e=NaN;#n=NaN;constructor(t){const e=X(v.#t.cloneNode(!0),SVGGElement);this.element=e,this.decorationElement=e.querySelector("text.crystal-decoration"),this.decorationBackgroundElement=e.querySelector("text.crystal-decoration-background"),this.bombElement=e.querySelector(".bomb"),e.style.fill=t.color,this.decorationBackgroundElement.style.stroke=t.color,this.bombElement.style.fill=b(_.get(t.color)),this.bombVisible=!1,this.updateFinalPosition(t),q.appendChild(e)}async remove(){let t,e;t=Math.random()*(h.SIZE/2-1),e=Math.random()*(h.SIZE/2-1);{const o=Math.random()*3;o>1&&(t-=h.SIZE/2),o<2&&(e-=h.SIZE/2)}{const o=r=>Math.random()>(r+1)/(h.SIZE+1);o(this.#e)&&(t=h.SIZE-t-1),o(this.#n)&&(e=h.SIZE-e-1)}await this.slideDirectlyTo({rowIndex:t,columnIndex:e},{duration:1e3,easing:"ease-in"}),this.element.remove(),this.element="💀"}}const $=n=>x(n+.5,h.SIZE)-.5,z=(n,t)=>{const e=[n],o=[0];if(Math.abs(n-t)>h.SIZE/2){const r=(s,a)=>{e.push(s,a);const i=Math.abs(n-s),l=Math.abs(a-t),u=i+l,d=i/u;o.push(d,d)};t>n?r(-.5,h.SIZE-.5):r(h.SIZE-.5,-.5)}return e.push(t),o.push(1),{position:e,offset:o}};class xt{cancelGroup(t){const e=this.#t.get(t);e.element.getAnimations().forEach(o=>o.cancel()),e.decorationElement.textContent="",e.decorationBackgroundElement.textContent=""}#t=new Map;initializePiece(t){this.#t.set(t,new v(t))}destroyPiece(t){const e=this.#t.get(t);return this.#t.delete(t),e.remove()}jumpTo(t){this.#t.get(t).updateFinalPosition(t)}slideTo(t){return this.#t.get(t).slideDirectlyTo(t)}drawPreview(t,e,o){e.forEach(r=>{const s=this.#t.get(r);let{rowIndex:a,columnIndex:i}=r;t=="vertical"?a=$(a+o):i=$(i+o),s.updateFinalPosition({rowIndex:a,columnIndex:i})})}async rotateTo(t,e){const o=e.map(r=>this.#t.get(r).rotateTo(r,t));await Promise.all(o)}updateBomb(t){const e=this.#t.get(t);e.bombVisible=t.bomb}assignGroupDecorations(t){if(t.length==0)return{addToScore(){return Promise.resolve()},highlightGroups(){R()}};{const e=[...St],o=t.map(s=>{const a=s[0].color,i=b(_.get(a)),l=Math.floor(Math.random()*e.length),u=e[l];return e.splice(l,1),{guiPieces:s.map(f=>{const p=this.#t.get(f);if(p==null)throw new Error("wtf");return p}),decorationColor:i,decorationText:u,backgroundColor:a}}),r=s=>{A=Math.pow(.8,s-1)*.9+.1};return{async addToScore(s){r(s),o.forEach(({guiPieces:a})=>{const u=[{opacity:Math.random()*.2+.05},{opacity:1}],d={direction:b(["alternate","alternate-reverse","normal","reverse"]),duration:(550+Math.random()*150)*A,easing:b(["linear","ease-in","ease-out","ease-in-out"]),iterationStart:Math.random(),iterations:1/0};a.forEach(f=>{f.decorationElement.animate(u,d),f.decorationBackgroundElement.animate(u,d)})}),s<2?G.innerHTML="":G.innerText=`Chain Bonus: ⨉ ${s}`,T.innerHTML="",o.forEach(({guiPieces:a,decorationColor:i,decorationText:l,backgroundColor:u},d)=>{d>0&&T.append(" + ");const f=document.createElement("span");f.innerText=`${l} ${a.length}`,f.style.color=i,f.style.borderColor=f.style.backgroundColor=u,f.classList.add("individualScore"),T.appendChild(f)}),await P(2e3)},highlightGroups(){R(),o.forEach(({guiPieces:s,decorationColor:a,decorationText:i})=>{s.forEach(l=>{const u=l.decorationElement;u.textContent=i,u.style.fill=a,l.decorationBackgroundElement.textContent=i})})}}}}}const Ct=new xt,kt=""+new URL("cursor-2110db60.svg",import.meta.url).href;function Tt(n){const t=g("main",SVGSVGElement);function e(r){const s=t.getBoundingClientRect(),a=M(s.top,0,s.bottom,h.SIZE),i=M(s.left,0,s.right,h.SIZE);return{row:a(r.clientY),column:i(r.clientX)}}let o={state:"none"};t.addEventListener("pointerdown",r=>{if(o.state=="none"){r.stopPropagation(),t.setPointerCapture(r.pointerId);const s=e(r);t.style.cursor="move",o={state:"started",startRow:s.row,startColumn:s.column}}}),t.addEventListener("pointermove",r=>{if(o.state=="none"||o.state=="animation")return;r.stopPropagation();const s=e(r);if(o.state=="started"){const a=Math.abs(s.row-o.startRow),i=Math.abs(s.column-o.startColumn);if(Math.max(a,i)<.05)return;if(a>i){const l="vertical",u=Math.floor(o.startColumn),d=o.startRow,f=w=>{const{row:I}=e(w);return I-d},p=n.startVerticalMove(u);o={state:l,fixedIndex:u,startIndex:d,relevantMouseMove:f,actions:p},t.style.cursor="ns-resize"}else if(i>a){const l="horizontal",u=Math.floor(o.startRow),d=o.startColumn,f=w=>{const{column:I}=e(w);return I-d},p=n.startHorizontalMove(u);o={state:l,fixedIndex:u,startIndex:d,relevantMouseMove:f,actions:p},t.style.cursor="ew-resize"}else return}o.actions.preview(o.relevantMouseMove(r))}),t.addEventListener("lostpointercapture",async r=>{switch(o.state){case"started":break;case"horizontal":case"vertical":{t.style.cursor=`url("${kt}"),none`;const s=o;o={state:"animation"},await s.actions.release(s.relevantMouseMove(r));break}default:throw new Error("wtf")}o={state:"none"},t.style.cursor="grab"})}function At(n,t,e){if(!(t>=0&&t<=1))throw new Error("Expected 0 ≤ t ≤ 1");const o=Math.max(0,t-e),r=n(o),s=Math.max(0,t+e),a=n(s),i=a.x-r.x,l=a.y-r.y;return i==0&&l==0?NaN:Math.atan2(l,i)}function U(n,t={}){const e=Math.ceil(t.numberOfSegments??10);if(e<1)throw new Error(`Invalid numberOfSegments: ${e}`);const o=.01/e,r=y(e+1,i=>{const l=i/e,u=n(l),d=At(n,l,o);return{t:l,point:u,direction:d}}),s=y(e,i=>[{from:r[i],to:r[i+1]}][0]);console.log({samples:r,segments:s});let a=`M ${s[0].from.point.x}, ${s[0].from.point.y}`;return s.forEach(i=>{const l=$t({x0:i.from.point.x,y0:i.from.point.y,slope:Math.tan(i.from.direction)},{x0:i.to.point.x,y0:i.to.point.y,slope:Math.tan(i.to.direction)});l?a+=` Q ${l.x},${l.y}`:a+=" M",a+=` ${i.to.point.x},${i.to.point.y}`}),a}function Pt(n,t,e){const o=Ft(n,t,e);return U(o,{numberOfSegments:e*9.001002})}function Ft(n,t,e){const s={x:n.x-t.x,y:n.y-t.y},a=Math.hypot(s.x,s.y),i=M(0,a,1,0),l=Math.atan2(s.y,s.x),u=M(0,l,1,l+e*2*Math.PI);return function(d){const f=i(d),p=u(d),w=j(f,p);return{x:t.x+w.x,y:t.y+w.y}}}function Gt(n,t,e){const o=M(0,t,1,e);return r=>j(n,o(r))}function Nt(n,t){const e=M(0,n.x,1,t.x),o=M(0,n.y,1,t.y);return r=>({x:e(r),y:o(r)})}function Rt(n,t,...e){const o=i=>{const l={x:0,y:0};return e.forEach(u=>{const d=u(i);l.x+=d.x,l.y+=d.y}),l},r=o(0),s=o(1),a=Nt({x:n.x-r.x,y:n.y-r.y},{x:t.x-s.x,y:t.y-s.y});return e.push(a),console.log({desiredFrom:n,computedFrom:o(0),desiredTo:t,computedTo:o(1)}),o}function $t(n,t){if(isNaN(n.slope)||isNaN(t.slope)||n.slope==t.slope)return;const e=n.slope==1/0||n.slope==-1/0,o=t.slope==1/0||t.slope==-1/0;if(e||o)return;const r=e?n.x0:o?t.x0:(t.y0-t.slope*t.x0-n.y0+n.slope*n.x0)/(n.slope-t.slope),s=e?t.slope*(r-t.x0)+t.y0:n.slope*(r-n.x0)+n.y0;return{x:r,y:s}}{let n="☆";setInterval(()=>{document.title=`${n} Classic Chuzzle`,n=n=="☆"?"★":"☆"},1e3)}{const[n,t,e]=g("background",SVGGElement).querySelectorAll("circle");n.animate([{transform:"rotate(720deg)"},{transform:"rotate(0deg)"}],{duration:67973,easing:"ease",iterations:1/0}),t.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:19701,easing:"cubic-bezier(0.42, 0, 0.32, 1.83)",iterations:1/0}),e.animate(E.flatMap((o,r)=>[{fill:o,opacity:0,offset:r/E.length},{fill:o,opacity:.15,offset:(r+.25)/E.length},{fill:o,opacity:.15,offset:(r+.75)/E.length},{fill:o,opacity:0,offset:(r+1)/E.length}]),{duration:4e3*E.length,iterations:1/0})}g("main",SVGSVGElement).animate({backgroundColor:["#404040","#C0C0C0","#404040"]},{duration:97531,direction:"alternate",iterations:1/0});Tt(new h(Ct));async function zt(){const n=g("main",SVGSVGElement),t=()=>{const l=g("piece",HTMLTemplateElement).content.querySelector(".bomb");return X(l.cloneNode(!0),SVGPathElement)},e=()=>{const l=Math.random()*h.SIZE|0,u=Math.random()*h.SIZE|0;return{x:l,y:u}},o=l=>{for(;;){const u=e();if(u.x!=l.x||u.y!=l.y)return u}},r=document.createElementNS("http://www.w3.org/2000/svg","path");r.style.fill="none",r.style.stroke="white",r.style.strokeWidth="0.02px",r.style.strokeLinecap="round",r.style.transform="translate(0.5px,0.5px)",n.appendChild(r);const s=t();s.style.fill="black";const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.appendChild(s),n.appendChild(a),a.style.offsetRotate="0deg";let i=e();for(;;){const l=i;i=o(l);let u;if(Math.random()<.3333333)u=Pt(l,i,.5+Math.random()*2+Math.random()*2);else{const f=Math.random()*2*Math.PI,p=(Math.random()*2|0)*2-1,w=f+p*(.5+Math.random()*2)*2*Math.PI,I=.5+Math.random()*2,K=Rt(l,i,Gt(I,f,w));u=U(K,{numberOfSegments:20})}a.style.offsetPath=`path('${u}')`;const d=a.animate({offsetDistance:["0%","100%"]},{duration:3e3,iterations:1,easing:"ease-in-out",fill:"both"});r.setAttribute("d",u),r.style.display="none",await d.finished,r.style.display="",await P(2e3)}}zt();
