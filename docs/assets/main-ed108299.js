(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var g={},c={};Object.defineProperty(c,"__esModule",{value:!0});c.permutations=c.polarToRectangular=c.makeBoundedLinear=I=c.makeLinear=c.sum=c.countMap=E=c.initializedArray=c.count=c.zip=c.FIGURE_SPACE=c.NON_BREAKING_SPACE=c.dateIsValid=c.MIN_DATE=c.MAX_DATE=c.makePromise=c.filterMap=b=c.pick=c.pickAny=c.csvStringToArray=c.parseTimeT=c.parseIntX=c.parseFloatX=c.getAttribute=c.followPath=c.parseXml=c.testXml=z=c.sleep=c.assertClass=void 0;function et(e,t,n="Assertion Failed."){const o=r=>{throw new Error(`${n}  Expected type:  ${t.name}.  Found type:  ${r}.`)};if(e===null)o("null");else if(typeof e!="object")o(typeof e);else if(!(e instanceof t))o(e.constructor.name);else return e;throw new Error("wtf")}c.assertClass=et;function nt(e){return new Promise(t=>setTimeout(t,e))}var z=c.sleep=nt;function O(e){const n=new DOMParser().parseFromString(e,"application/xml");for(const o of Array.from(n.querySelectorAll("parsererror")))if(o instanceof HTMLElement)return{error:o};return{parsed:n}}c.testXml=O;function ot(e){if(e!==void 0)return O(e)?.parsed?.documentElement}c.parseXml=ot;function V(e,...t){for(const n of t){if(e===void 0)return;if(typeof n=="number")e=e.children[n];else{const o=e.getElementsByTagName(n);if(o.length!=1)return;e=o[0]}}return e}c.followPath=V;function rt(e,t,...n){if(t=V(t,...n),t!==void 0&&t.hasAttribute(e))return t.getAttribute(e)??void 0}c.getAttribute=rt;function Z(e){if(e==null)return;const t=parseFloat(e);if(isFinite(t))return t}c.parseFloatX=Z;function H(e){const t=Z(e);if(t!==void 0)return t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER||t!=Math.floor(t)?void 0:t}c.parseIntX=H;function st(e){if(typeof e=="string"&&(e=H(e)),e!=null&&!(e<=0))return new Date(e*1e3)}c.parseTimeT=st;const it=e=>{const t=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,n=[[]];let o;for(;o=t.exec(e);)o[1].length&&o[1]!==","&&n.push([]),n[n.length-1].push(o[2]!==void 0?o[2].replace(/""/g,'"'):o[3]);return n};c.csvStringToArray=it;function at(e){const t=e.values().next();if(!t.done)return t.value}c.pickAny=at;function lt(e){return e[Math.random()*e.length|0]}var b=c.pick=lt;function ct(e,t){const n=[];return e.forEach((o,r)=>{const s=t(o,r);s!==void 0&&n.push(s)}),n}c.filterMap=ct;function ut(){let e,t;return{promise:new Promise((o,r)=>{e=o,t=r}),resolve:e,reject:t}}c.makePromise=ut;c.MAX_DATE=new Date(864e13);c.MIN_DATE=new Date(-864e13);function dt(e){return isFinite(e.getTime())}c.dateIsValid=dt;c.NON_BREAKING_SPACE=" ";c.FIGURE_SPACE=" ";function*ft(...e){const t=e.map(n=>n[Symbol.iterator]());for(;;){const n=t.map(o=>o.next());if(n.some(({done:o})=>o))break;yield n.map(({value:o})=>o)}}c.zip=ft;function*ht(e=0,t=1/0,n=1){for(let o=e;o<t;o+=n)yield o}c.count=ht;function X(e,t){const n=[];for(let o=0;o<e;o++)n.push(t(o));return n}var E=c.initializedArray=X;c.countMap=X;function mt(e){return e.reduce((t,n)=>t+n,0)}c.sum=mt;function pt(e,t,n,o){const r=(o-t)/(n-e);return function(s){return(s-e)*r+t}}var I=c.makeLinear=pt;function gt(e,t,n,o){n<e&&([e,t,n,o]=[n,o,e,t]);const r=(o-t)/(n-e);return function(s){return s<=e?t:s>=n?o:(s-e)*r+t}}c.makeBoundedLinear=gt;function wt(e,t){return{x:Math.sin(t)*e,y:Math.cos(t)*e}}c.polarToRectangular=wt;function*j(e,t=[]){if(e.length==0)yield t;else for(let n=0;n<e.length;n++){const o=e[n],r=[...t,o],s=[...e.slice(0,n),...e.slice(n+1)];yield*j(s,r)}}c.permutations=j;Object.defineProperty(g,"__esModule",{value:!0});g.download=g.createElementFromHTML=g.getHashInfo=g.getAudioBalanceControl=g.getBlobFromCanvas=g.loadDateTimeLocal=y=g.getById=void 0;const _=c;function yt(e,t){const n=document.getElementById(e);if(!n)throw new Error("Could not find element with id "+e+".  Expected type:  "+t.name);if(n instanceof t)return n;throw new Error("Element with id "+e+" has type "+n.constructor.name+".  Expected type:  "+t.name)}var y=g.getById=yt;function Et(e,t,n="milliseconds"){let o;switch(n){case"minutes":{o=t.getSeconds()*1e3+t.getMilliseconds();break}case"seconds":{o=t.getMilliseconds();break}case"milliseconds":{o=0;break}default:throw new Error("wtf")}e.valueAsNumber=+t-t.getTimezoneOffset()*6e4-o}g.loadDateTimeLocal=Et;function bt(e){const{reject:t,resolve:n,promise:o}=(0,_.makePromise)();return e.toBlob(r=>{r?n(r):t(new Error("blob is null!"))}),o}g.getBlobFromCanvas=bt;function vt(e){const t=new AudioContext,n=t.createMediaElementSource(e),o=new StereoPannerNode(t,{pan:0});return n.connect(o).connect(t.destination),r=>{o.pan.value=r}}g.getAudioBalanceControl=vt;function It(){const e=new Map;return/^#?(.*)$/.exec(location.hash.replace("+","%20"))[1].split("&").forEach(o=>{const r=o.split("=",2);if(r.length==2){const s=decodeURIComponent(r[0]),a=decodeURIComponent(r[1]);e.set(s,a)}}),e}g.getHashInfo=It;function Mt(e,t){var n=document.createElement("div");return n.innerHTML=e.trim(),(0,_.assertClass)(n.firstChild,t,"createElementFromHTML:")}g.createElementFromHTML=Mt;function St(e,t){var n=document.createElement("a");if(n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),document.createEvent){var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!0),n.dispatchEvent(o)}else n.click()}g.download=St;class xt{#t=new Set;get contents(){return[...this.#t].map(t=>t.piece)}get size(){return this.#t.size}debugInitialCell;color;constructor(t){this.color=t.color,this.debugInitialCell=t,this.#t.add(t)}consume(t){const n=this.#t,o=t.#t;return o.forEach(r=>n.add(r)),t.#t=void 0,o}get valid(){return!!this.#t?.has(this.debugInitialCell)}}class F{constructor(t){this.piece=t,this.#t=new xt(this)}#t;get color(){return this.piece.color}static createAll(t){return t.map(n=>n.map(o=>new F(o)))}tryCombine(t){if(this.#t!=t.#t&&this.color==t.color&&(this.#t.consume(t.#t).forEach(o=>o.#t=this.#t),!this.#t.valid))throw new Error("wtf")}static combineAll(t){t.forEach((n,o)=>{n.forEach((r,s)=>{if(o){const a=o-1,i=t[a][s];r.tryCombine(i)}if(s){const a=s-1,i=n[a];r.tryCombine(i)}})})}static findBigGroups(t){const n=new Map;t.forEach(r=>r.forEach(s=>{const a=s.#t,i=n.get(a)??0;n.set(a,i+1)}));const o=[];for(const[r,s]of n)s>=3&&o.push(r);return o}static findActionable(t){const n=this.createAll(t);return this.combineAll(n),this.findBigGroups(n)}}function T(e){return F.findActionable(e).map(t=>t.contents)}function C(e,t){const n=e%t;return n<0?n+Math.abs(t):n}function kt(e,t){if((t|0)!=t)throw new Error(`invalid input: ${t}`);return t=C(t,e.length),t==0?e:[...e.slice(t),...e.slice(0,t)]}function G(e,t,n="Assertion Failed."){const o=r=>{throw new Error(`${n}  Expected type:  ${t.name}.  Found type:  ${r}.`)};if(e===null)o("null");else if(typeof e!="object")o(typeof e);else if(!(e instanceof t))o(e.constructor.name);else return e;throw new Error("wtf")}function U(e,t){return{x:Math.cos(t)*e,y:Math.sin(t)*e}}function q(e){if(e.length<1)throw new Error("wtf");const t=Math.random()*e.length|0;return e.splice(t,1)[0]}const A=e=>C(Math.round(e),f.SIZE);function Ct(e,t,n){const o=e[t],r=kt(o,n);return o==r?e:e.map(s=>s==o?r:s)}function Tt(e,t,n){const o=e.length;return n=C(n,o),n==0?e:e.map((r,s)=>{const a=[...r];return a[t]=e[(s+n)%o][t],a})}const w=["red","green","blue","yellow","orange","violet"];class k{constructor(t,n,o=k.randomColor()){this.rowIndex=t,this.columnIndex=n,this.color=o}weight=1;bomb=!1;static randomColor(){return b(w)}}class f{constructor(t){this.animator=t,this.#t=this.createRandom(),this.#t.forEach(n=>n.forEach(o=>this.animator.initializePiece(o)))}static SIZE=6;#t;getColumn(t){return this.#t.map(n=>n[t])}createRandom(){const t=E(f.SIZE,o=>E(f.SIZE,r=>new k(o,r)));return T(t).forEach(o=>{o.forEach(({rowIndex:r,columnIndex:s})=>{const a=new Set;[[0,1],[0,-1],[1,0],[-1,0]].forEach(([i,l])=>{const u=t[r+i];if(u){const d=u[s+l];d&&a.add(d.color)}}),t[r][s]=new k(r,s,b(w.filter(i=>!a.has(i))))})}),t}async updateLoop(t,n){for(let o=1;t.length>0;o++){const r=new Set,s=[];t.forEach(h=>{switch(h.length){case 3:case 6:{s.push(h);break}case 5:{const m=b(h);m.bomb=!0,r.add(m);break}}}),n.addToScore(o);const a=t.flatMap(h=>h.filter(m=>!r.has(m))),i=this.removePieces(a),l=this.#t.flat().filter(h=>!h.bomb),u=s.map(h=>{const m=[];return h.forEach(v=>{if(l.length>0){const x=q(l);m.push([v,x])}}),m}),d=performance.now();console.log("Starting updateBoard()."),await this.animator.updateBoard({remove:a,counter:o,flingBomb:u,add:i});const p=performance.now();console.log(`await updateBoard() took ${p-d}ms.`),t=T(this.#t),n=this.animator.assignGroupDecorations(t),n.highlightGroups()}}setAllPieces(t){this.#t=t,t.forEach((n,o)=>{n.forEach((r,s)=>{r.columnIndex=s,r.rowIndex=o})})}startHorizontalMove(t){const n=E(f.SIZE,s=>{const a=Ct(this.#t,t,-s),i=T(a);return{actions:this.animator.assignGroupDecorations(i),groups:i,pieces:a}}),o=s=>{const a=this.#t[t];this.animator.drawPreview("horizontal",a,s),n[A(s)].actions.highlightGroups()};return{preview:o,release:async s=>{o(s);const a=A(s),l=n[a].groups.length==0?0:a,u=n[l];this.setAllPieces(u.pieces);const d=this.#t[t];await this.animator.rotateTo("horizontal",d),await this.updateLoop(u.groups,u.actions)}}}startVerticalMove(t){const n=E(f.SIZE,s=>{const a=Tt(this.#t,t,-s),i=T(a);return{actions:this.animator.assignGroupDecorations(i),groups:i,pieces:a}}),o=s=>{const a=this.getColumn(t);this.animator.drawPreview("vertical",a,s),n[A(s)].actions.highlightGroups()};return{preview:o,release:async s=>{o(s);const a=A(s),l=n[a].groups.length==0?0:a,u=n[l];this.setAllPieces(u.pieces);const d=this.getColumn(t);await this.animator.rotateTo("vertical",d),await this.updateLoop(u.groups,u.actions)}}}removePieces(t){const n=E(f.SIZE,()=>new Set);t.forEach(({rowIndex:s,columnIndex:a})=>{const i=n[a];if(i.has(s))throw new Error("wtf");i.add(s)});const o=E(f.SIZE,()=>new Array(f.SIZE)),r=[];return n.forEach((s,a)=>{const i=[];for(let l=0;l<f.SIZE;l++)s.has(l)||i.push(this.#t[l][a]);for(let l=0;i.length<f.SIZE;l++){const u=-1-l,d=new k(NaN,a);r.push({initialRow:u,piece:d}),i.unshift(d)}i.forEach((l,u)=>{o[u][a]=l,l.columnIndex=a,l.rowIndex=u})}),this.setAllPieces(o),r}}function At(e,t,n){if(!(t>=0&&t<=1))throw new Error("Expected 0 ≤ t ≤ 1");const o=Math.max(0,t-n),r=e(o),s=Math.max(0,t+n),a=e(s),i=a.x-r.x,l=a.y-r.y;return i==0&&l==0?NaN:Math.atan2(l,i)}function K(e,t={}){const n=Math.ceil(t.numberOfSegments??10);if(n<1)throw new Error(`Invalid numberOfSegments: ${n}`);const o=.01/n,r=E(n+1,i=>{const l=i/n,u=e(l),d=At(e,l,o);return{t:l,point:u,direction:d}}),s=E(n,i=>[{from:r[i],to:r[i+1]}][0]);let a=`M ${s[0].from.point.x}, ${s[0].from.point.y}`;return s.forEach(i=>{const l=Lt({x0:i.from.point.x,y0:i.from.point.y,slope:Math.tan(i.from.direction)},{x0:i.to.point.x,y0:i.to.point.y,slope:Math.tan(i.to.direction)});l?a+=` Q ${l.x},${l.y}`:a+=" M",a+=` ${i.to.point.x},${i.to.point.y}`}),a}function Pt(e,t,n){const o=Rt(e,t,n);return K(o,{numberOfSegments:n*9.001002})}function Rt(e,t,n){const s={x:e.x-t.x,y:e.y-t.y},a=Math.hypot(s.x,s.y),i=I(0,a,1,0),l=Math.atan2(s.y,s.x),u=I(0,l,1,l+n*2*Math.PI);return function(d){const p=i(d),h=u(d),m=U(p,h);return{x:t.x+m.x,y:t.y+m.y}}}function Gt(e,t,n){const o=I(0,t,1,n);return r=>U(e,o(r))}function Ft(e,t){const n=I(0,e.x,1,t.x),o=I(0,e.y,1,t.y);return r=>({x:n(r),y:o(r)})}function Nt(e,t,...n){const o=i=>{const l={x:0,y:0};return n.forEach(u=>{const d=u(i);l.x+=d.x,l.y+=d.y}),l},r=o(0),s=o(1),a=Ft({x:e.x-r.x,y:e.y-r.y},{x:t.x-s.x,y:t.y-s.y});return n.push(a),o}function Lt(e,t){if(isNaN(e.slope)||isNaN(t.slope)||e.slope==t.slope)return;const n=e.slope==1/0||e.slope==-1/0,o=t.slope==1/0||t.slope==-1/0;if(n||o)return;const r=n?e.x0:o?t.x0:(t.y0-t.slope*t.x0-e.y0+e.slope*e.x0)/(e.slope-t.slope),s=n?t.slope*(r-t.x0)+t.y0:e.slope*(r-e.x0)+e.y0;return{x:r,y:s}}const P=y("newScore",HTMLDivElement),L=y("chainBonus",HTMLDivElement),Q=new Map([["orange",["cyan","brown","white","darkviolet","lightyellow","darkgreen","darkolivegreen","darkred"]],["yellow",["brown","darkviolet","lightcoral","lightsalmon","lightseagreen","darkblue","darkcyan","darkgoldenrod","darkgreen","darkkhaki","darkolivegreen","darkorange","darkred","darksalmon","darkseagreen"]],["violet",["cyan","brown","white","darkviolet","lightgreen","darkblue"]],["blue",["cyan","white","lightcoral","lightgreen","lightgray","lightsalmon","lightseagreen","lightseagreen","lightskyblue","lightslategray","darkorange","darkseagreen","darkturquoise"]],["red",["cyan","white","lightcoral","lightgreen","lightsalmon","darkkhaki","darkseagreen","chartreuse"]],["green",["cyan","white","lightcoral","lightcyan","lightgreen","lightyellow","darkred","darkseagreen","chartreuse"]]]),N=["༟","༴","℣","⌰","⍷","⎙","ʻ","☆","𝛿","∞","•","⭑","†","‡","؟","༗","ၯ","◦","§","_","ɝ","Ԕ","⟳","⚐","🜚","愛","❝","ℵ","を","ᇸ","ڰ","ॾ","ན","ᛧ","ß","⧕","↯","➷","⅋","☙","„","⌥","⧷","⁎","╕","₰","…","⑈","۽","ₜ","ಠ","෴","ጃ","ᔱ","ᔰ","Ѧ","ᑥ","𝄢","ƈ","Ɣ","ƕ","Ɋ","ɕ","ɮ","ʆ","Ξ","Ж","Ѭ","Զ","ঔ","ਐ","ઝ","ଈ","ஜ","ధ","ൠ","ඊ","ጯ","ᡀ","‰","₻","↉","↜","↸","⋨","⌤","⎌","⍾","☏","✗","➘","〷","ご","ᇌ","㊤","﹆","🜇","🝤"];setInterval(()=>{document.title=`${b(N)} Classic Chuzzle`},1500);let S=1;function W(e){return Math.abs(e)*2e3/f.SIZE*S}const Y=y("board",SVGElement);function R(){Y.querySelectorAll("text.crystal-decoration,text.crystal-decoration-background").forEach(e=>e.textContent="")}class M{static#t=y("piece",HTMLTemplateElement).content.querySelector("g");element;decorationElement;decorationBackgroundElement;bombElement;get bombVisible(){return this.bombElement.style.display==""}set bombVisible(t){this.bombElement.style.display=t?"":"none"}static#o=CSS.px(Math.E);static#r=CSS.px(Math.PI);static#s=new CSSTransformValue([new CSSTranslate(this.#o,this.#r)]);updateFinalPosition(t){this.#n=t.columnIndex,this.#e=t.rowIndex,M.#o.value=t.columnIndex,M.#r.value=t.rowIndex,this.element.attributeStyleMap.set("transform",M.#s)}async slideDirectlyTo(t,n){const o=this.#n,r=this.#e,s=t.columnIndex,a=t.rowIndex;(o!=s||r!=a)&&(await this.element.animate([{transform:`translate(${o}px, ${r}px)`},{transform:`translate(${s}px, ${a}px)`}],n).finished,this.updateFinalPosition(t))}async rotateTo(t,n){const o=n=="horizontal",r=(()=>{const l=o?t.columnIndex-this.#n:t.rowIndex-this.#e,u=C(l+f.SIZE/2,f.SIZE)-f.SIZE/2;return W(Math.abs(u))})(),{position:s,offset:a}=o?D(this.#n,t.columnIndex):D(this.#e,t.rowIndex),i=s.map(l=>o?`translate(${l}px, ${t.rowIndex}px)`:`translate(${t.columnIndex}px, ${l}px)`);this.updateFinalPosition(t),await this.element.animate({transform:i,offset:a},r).finished}#e=NaN;get rowIndex(){return this.#e}#n=NaN;get columnIndex(){return this.#n}constructor(t){const n=G(M.#t.cloneNode(!0),SVGGElement);this.element=n,this.decorationElement=n.querySelector("text.crystal-decoration"),this.decorationBackgroundElement=n.querySelector("text.crystal-decoration-background"),this.bombElement=n.querySelector(".bomb"),n.style.fill=t.color,this.decorationBackgroundElement.style.stroke=t.color,this.bombColor=b(Q.get(t.color)),this.bombVisible=!1,this.updateFinalPosition(t),Y.appendChild(n)}async remove(t=0){let n,o;n=Math.random()*(f.SIZE/2-1),o=Math.random()*(f.SIZE/2-1);{const r=Math.random()*3;r>1&&(n-=f.SIZE/2),r<2&&(o-=f.SIZE/2)}{const r=s=>Math.random()>(s+1)/(f.SIZE+1);r(this.#e)&&(n=f.SIZE-n-1),r(this.#n)&&(o=f.SIZE-o-1)}this.element.parentElement.appendChild(this.element),await this.slideDirectlyTo({rowIndex:n,columnIndex:o},{duration:1e3*S,easing:"ease-in",delay:t,fill:"backwards"}),this.element.remove(),this.element="💀"}get bombColor(){return this.bombElement.style.fill}set bombColor(t){this.bombElement.style.fill=t}}const $=e=>C(e+.5,f.SIZE)-.5,D=(e,t)=>{const n=[e],o=[0];if(Math.abs(e-t)>f.SIZE/2){const r=(s,a)=>{n.push(s,a);const i=Math.abs(e-s),l=Math.abs(a-t),u=i+l,d=i/u;o.push(d,d)};t>e?r(-.5,f.SIZE-.5):r(f.SIZE-.5,-.5)}return n.push(t),o.push(1),{position:n,offset:o}},B=y("piece",HTMLTemplateElement).content.querySelector(".bomb"),$t=y("main",SVGSVGElement);class Dt{async updateBoard(t){this.#t.forEach((i,l)=>{i.bombVisible=l.bomb}),S=Math.pow(.75,t.counter-1)*.9+.1;const n=2e3*S,o=Promise.all(t.remove.map(i=>{const l=this.#t.get(i).remove(n);return this.#t.delete(i),l}));setTimeout(()=>R(),n);const r=1e3*S;t.add.forEach(({initialRow:i,piece:l})=>{const u=new M(l);this.#t.set(l,u),u.updateFinalPosition({columnIndex:l.columnIndex,rowIndex:i})});const s=[];this.#t.forEach((i,l)=>{const u=i.columnIndex,d=i.rowIndex,p=l.columnIndex,h=l.rowIndex,m=Math.hypot(h-d,p-u),x={duration:W(m),delay:n+r,fill:"backwards"};s.push(()=>i.slideDirectlyTo(l,x))});const a=Promise.all(s.map(i=>i()));await Promise.all([o,a])}async flingBomb(t,n,o,r){const s=this.#t.get(t),a=this.#t.get(n),i=n.color,l=a.bombColor;s.bombColor=l,s.bombVisible=!0;const u=(()=>{const p=G(B.cloneNode(!0),SVGPathElement),h=G(B.cloneNode(!0),SVGPathElement);h.style.strokeWidth="75",p.style.fill=l,h.style.stroke=i;const m=document.createElementNS("http://www.w3.org/2000/svg","g");return m.appendChild(h),m.appendChild(p),m.style.offsetRotate="0deg",m})(),d=(()=>{const p={x:t.columnIndex,y:t.rowIndex},h={x:n.columnIndex,y:n.rowIndex};if(Math.random()<.3333333)return Pt(p,h,.5+Math.random()*2+Math.random()*2);{const m=Math.random()*2*Math.PI,v=(Math.random()*2|0)*2-1,x=m+v*(.5+Math.random()*2)*2*Math.PI,J=.5+Math.random()*2,tt=Nt(p,h,Gt(J,m,x));return K(tt,{numberOfSegments:20})}})();await z(o),s.bombVisible=!1,$t.appendChild(u),u.style.offsetPath=`path('${d}')`,await u.animate({offsetDistance:["0%","100%"]},{delay:o,duration:r,iterations:1,easing:"ease-in-out",fill:"both"}).finished,u.remove(),a.bombVisible=!0}#t=new Map;initializePiece(t){this.#t.set(t,new M(t))}jumpTo(t){this.#t.get(t).updateFinalPosition(t)}drawPreview(t,n,o){n.forEach(r=>{const s=this.#t.get(r);let{rowIndex:a,columnIndex:i}=r;t=="vertical"?a=$(a+o):i=$(i+o),s.updateFinalPosition({rowIndex:a,columnIndex:i})})}async rotateTo(t,n){const o=n.map(r=>this.#t.get(r).rotateTo(r,t));await Promise.all(o)}assignGroupDecorations(t){if(t.length==0)return{addToScore(){},highlightGroups(){R()}};{const n=[...N],o=t.map(r=>{const s=r[0].color,a=b(Q.get(s)),i=q(n);return{guiPieces:r.map(u=>{const d=this.#t.get(u);if(d==null)throw new Error("wtf");return d}),decorationColor:a,decorationText:i,backgroundColor:s}});return{addToScore(r){o.forEach(({guiPieces:s})=>{const l=[{opacity:Math.random()*.2+.05},{opacity:1}],u={direction:b(["alternate","alternate-reverse","normal","reverse"]),duration:(550+Math.random()*150)*S,easing:b(["linear","ease-in","ease-out","ease-in-out"]),iterationStart:Math.random(),iterations:1/0};s.forEach(d=>{d.decorationElement.animate(l,u),d.decorationBackgroundElement.animate(l,u)})}),r<2?L.innerHTML="":L.innerText=`Chain Bonus: ⨉ ${r}`,P.innerHTML="",o.forEach(({guiPieces:s,decorationColor:a,decorationText:i,backgroundColor:l},u)=>{u>0&&P.append(" + ");const d=document.createElement("span");d.innerText=`${i} ${s.length}`,d.style.color=a,d.style.borderColor=d.style.backgroundColor=l,d.classList.add("individualScore"),P.appendChild(d)})},highlightGroups(){R(),o.forEach(({guiPieces:r,decorationColor:s,decorationText:a})=>{r.forEach(i=>{const l=i.decorationElement;l.textContent=a,l.style.fill=s,i.decorationBackgroundElement.textContent=a})})}}}}}const Bt=new Dt,zt=y("decorationTester",HTMLDivElement);N.forEach(e=>{const t=document.createElement("div");t.innerText=`${e} u+${e.codePointAt(0).toString(16)}`,zt.appendChild(t)});const Ot=""+new URL("cursor-2110db60.svg",import.meta.url).href;function Vt(e){const t=y("main",SVGSVGElement);function n(r){const s=t.getBoundingClientRect(),a=I(s.top,0,s.bottom,f.SIZE),i=I(s.left,0,s.right,f.SIZE);return{row:a(r.clientY),column:i(r.clientX)}}let o={state:"none"};t.addEventListener("pointerdown",r=>{if(o.state=="none"){r.stopPropagation(),t.setPointerCapture(r.pointerId);const s=n(r);t.style.cursor="move",o={state:"started",startRow:s.row,startColumn:s.column}}}),t.addEventListener("pointermove",r=>{if(o.state=="none"||o.state=="animation")return;r.stopPropagation();const s=n(r);if(o.state=="started"){const a=Math.abs(s.row-o.startRow),i=Math.abs(s.column-o.startColumn);if(Math.max(a,i)<.05)return;if(a>i){const l="vertical",u=Math.floor(o.startColumn),d=o.startRow,p=m=>{const{row:v}=n(m);return v-d},h=e.startVerticalMove(u);o={state:l,fixedIndex:u,startIndex:d,relevantMouseMove:p,actions:h},t.style.cursor="ns-resize"}else if(i>a){const l="horizontal",u=Math.floor(o.startRow),d=o.startColumn,p=m=>{const{column:v}=n(m);return v-d},h=e.startHorizontalMove(u);o={state:l,fixedIndex:u,startIndex:d,relevantMouseMove:p,actions:h},t.style.cursor="ew-resize"}else return}o.actions.preview(o.relevantMouseMove(r))}),t.addEventListener("lostpointercapture",async r=>{switch(o.state){case"started":break;case"horizontal":case"vertical":{t.style.cursor=`url("${Ot}"),none`;const s=o;o={state:"animation"},await s.actions.release(s.relevantMouseMove(r));break}default:throw new Error("wtf")}o={state:"none"},t.style.cursor="grab"})}{const[e,t]=y("background",SVGGElement).querySelectorAll("circle");e.animate([{transform:"rotate(720deg)"},{transform:"rotate(0deg)"}],{duration:67973,easing:"ease",iterations:1/0}),t.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:19701,easing:"cubic-bezier(0.42, 0, 0.32, 1.83)",iterations:1/0})}y("thinPatternLine",SVGLineElement).animate(w.flatMap((e,t)=>[{stroke:"black",offset:t/w.length},{stroke:e,offset:(t+.25)/w.length},{stroke:e,offset:(t+.75)/w.length},{stroke:"black",offset:(t+1)/w.length}]),{duration:4e3*w.length,iterations:1/0});y("thickPatternLine",SVGLineElement).animate(w.flatMap((e,t)=>[{stroke:"white",offset:t/w.length},{stroke:e,offset:(t+.25)/w.length},{stroke:e,offset:(t+.75)/w.length},{stroke:"white",offset:(t+1)/w.length}]),{duration:4321*w.length,iterations:1/0});y("main",SVGSVGElement).animate({backgroundColor:["#202020","#e0e0e0","#202020"]},{duration:97531,direction:"alternate",iterations:1/0});Vt(new f(Bt));
